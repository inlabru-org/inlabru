<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Spatially Varying Coefficient Models with inlabru • inlabru</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatially Varying Coefficient Models with inlabru">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">inlabru</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.11.1.9017</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-general-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">General examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-general-examples">
<li><h6 class="dropdown-header" data-toc-skip>Basic examples</h6></li>
    <li><a class="dropdown-item" href="../articles/random_fields.html">Random field models in 1D</a></li>
    <li><a class="dropdown-item" href="../articles/random_fields_2d.html">Spatial random field models in 2D</a></li>
    <li><a class="dropdown-item" href="../articles/publications.html">Publications</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Concepts</h6></li>
    <li><a class="dropdown-item" href="../articles/component.html">Defining a model component</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Special models and techniques</h6></li>
    <li><a class="dropdown-item" href="../articles/svc.html">Spatially varying coefficient models</a></li>
    <li><a class="dropdown-item" href="../articles/zip_zap_models.html">ZIP and ZAP count models (zero-inflation)</a></li>
    <li><a class="dropdown-item" href="../articles/prediction_scores.html">Computing posterior prediction scores</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/articles.html">Full articles list</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-point-processes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Point processes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-point-processes">
<li><h6 class="dropdown-header" data-toc-skip>Point process examples</h6></li>
    <li><a class="dropdown-item" href="../articles/1d_lgcp.html">LGCPs - An example in one dimension</a></li>
    <li><a class="dropdown-item" href="../articles/2d_lgcp.html">LGCPs - An example in two dimensions (sf version)</a></li>
    <li><a class="dropdown-item" href="../articles/2d_lgcp_sp.html">LGCPs - An example in two dimensions (sp version)</a></li>
    <li><a class="dropdown-item" href="../articles/2d_lgcp_covars.html">LGCPs - Spatial covariates</a></li>
    <li><a class="dropdown-item" href="../articles/2d_lgcp_distancesampling.html">LGCPs - Distance sampling</a></li>
    <li><a class="dropdown-item" href="../articles/2d_lgcp_plotsampling.html">LGCPs - Plot sampling</a></li>
    <li><a class="dropdown-item" href="../articles/2d_lgcp_multilikelihood.html">LGCPs - Multiple likelihoods</a></li>
    <li><a class="dropdown-item" href="../articles/2d_lgcp_spatiotemporal.html">LGCPs - An example in space and time</a></li>
    <li><a class="dropdown-item" href="../articles/2d_lgcp_residuals_sf.html">LGCPs - Residuals (sf version)</a></li>
    <li><a class="dropdown-item" href="../articles/2d_lgcp_residuals.html">LGCPs - Residuals (sp version)</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical-articles">
<li><h6 class="dropdown-header" data-toc-skip>Mapper techniques</h6></li>
    <li><a class="dropdown-item" href="../articles/bru_mapper.html">Customised model component with the bru_mapper system</a></li>
    <li><a class="dropdown-item" href="../articles/mesh_mapping.html">Converting inla.spde.make.A calls to the bru_mapper system</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Theory and technical documentation</h6></li>
    <li><a class="dropdown-item" href="../articles/Apptainer.html">Installation of INLA and inlabru with Apptainer on HPC</a></li>
    <li><a class="dropdown-item" href="../articles/method.html">The iterative linearised inlabru method</a></li>
    <li><a class="dropdown-item" href="../articles/linearapprox.html">A nonlinear model approximation example</a></li>
    <li><a class="dropdown-item" href="../articles/devel_flow.html">Code internal flow diagrams for model evaluation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/inlabru-org/inlabru/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Spatially Varying Coefficient Models with inlabru</h1>
                        <h4 data-toc-skip class="author">Timothy D.
Meehan (<a href="mailto:tmeeha@gmail.com" class="email">tmeeha@gmail.com</a>), Elias T. Krainski, Finn Lindgren,
and Håvard Rue</h4>
            
            <h4 data-toc-skip class="date">Generated on 2024-10-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/inlabru-org/inlabru/blob/devel/vignettes/articles/svc.Rmd" class="external-link"><code>vignettes/articles/svc.Rmd</code></a></small>
      <div class="d-none name"><code>svc.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Spatially varying coefficient models (SVCs, Gelfand et al. 2003) are
often used to model data when relationships between dependent and
independent variables are not uniform across space, a common situation
when exploring phenomena across large spatial extents (Finley 2011).
Meehan et al. (2019) described an SVC model to evaluate continent-scaled
variation in bird abundance trends. The SVC model used in that analysis
employed discrete aerial units (100 km grid cells), with spatial
structure described by neighborhood matrices and spatial relationships
described by an intrinsic conditional autoregressive model (Besag 1974).
The online supplement for the paper included code for building the model
using the <code>R-INLA</code> package (Rue et al. 2009) for the
<code>R</code> statistical programming language (R Core Team 2021). Both
the manuscript and code can be accessed at <a href="https://github.com/tmeeha/inlaSVCBC" class="external-link uri">https://github.com/tmeeha/inlaSVCBC</a>.</p>
<p>In this vignette, we will describe how to build an SVC model similar
to that described in Meehan et al. (2019), but within a continuous-space
framework. This model will be computed using the stochastic partial
differential equation (SPDE) approach of Lindgren et al. (2011, 2022),
implemented with the <code>inlabru</code> interface to the
<code>R-INLA</code> package for <code>R</code>. The SPDE approach
employs a computationally efficient approximation of a Gaussian random
field with parameters directly comparable to those of a Matérn
covariance function. The benefits of a continuous-space versus a
discrete-space SVC include the potential for finer resolution estimation
and prediction, a better understanding of the range of spatial
correlation, and a reduction in boundary effects associated with
discrete-space analyses.</p>
<p>We build the model using a subset of the data described in Meehan et
al. (2019). Specifically, we use counts of American Robin (<em>Turdus
migratorius</em>) from south central North America collected between
1987 and 2016 during the Audubon Christmas Bird Count (CBC). The overall
goal of the analysis is to produce spatially explicit estimates of
annual relative abundance as well as long-term relative abundance trends
for robins that account for spatial and temporal variation in count
effort.</p>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<p>The model used to analyze these data assumes that counts come from a
negative binomial distribution with an expected count and dispersion
parameter. The expected count has a log-linear predictor:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>κ</mi><mi>s</mi></msub><mo>+</mo><msub><mi>α</mi><mi>s</mi></msub><mo>+</mo><msub><mi>ϵ</mi><mi>s</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mtext mathvariant="normal">Effort</mtext><mrow><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo><msub><mi>τ</mi><mi>s</mi></msub><msub><mtext mathvariant="normal">Year</mtext><mrow><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\log(\lambda_{st}) = \kappa_{s} + \alpha_s + \epsilon_{s} \log[\text{Effort}_{st}] + \tau_{s} \text{Year}_{st}</annotation></semantics></math></p>
<p>where the natural log of expected count,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mrow><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log(\lambda_{st})</annotation></semantics></math>,
at site
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
during year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
is modeled with a zero-centered, normally distributed intercept per
site,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>κ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\kappa_s</annotation></semantics></math>,
a spatially varying intercept,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\alpha_s</annotation></semantics></math>,
a spatially varying effect of the log of count effort in hours,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\epsilon_s</annotation></semantics></math>,
and a spatially varying linear effect of year,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\tau_s</annotation></semantics></math>.
The spatially structured effects are modeled as Gaussian random fields
with Matérn covariance functions with range and variance parameters.</p>
<p>Model parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>κ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\kappa_s</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\alpha_s</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\epsilon_s</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\tau_s</annotation></semantics></math>
are analogous to those in Meehan et al. (2019). For example,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>κ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\kappa_s</annotation></semantics></math>
is included to account for site-level differences in counts, possibly
due to habitat availability or observer experience.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\alpha_s</annotation></semantics></math>
can be interpreted as an effort-corrected abundance index at year zero.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\epsilon_s</annotation></semantics></math>
is the exponent for a power-law effort-correction function. And
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\tau_s</annotation></semantics></math>
is the long-term temporal trend at a given site.</p>
</div>
<div class="section level2">
<h2 id="environment">Environment<a class="anchor" aria-label="anchor" href="#environment"></a>
</h2>
<p>To get started with data analysis, we set up the environment, by
loading some packages, and setting some options.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">maps</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dieghernan.github.io/tidyterra/" class="external-link">tidyterra</a></span><span class="op">)</span> <span class="co"># raster plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org" class="external-link">inlabru</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inlabru-org.github.io/fmesher/" class="external-link">fmesher</a></span><span class="op">)</span></span>
<span><span class="co"># Note: the 'splancs' package also needs to be installed,</span></span>
<span><span class="co"># but doesn't need to be loaded</span></span>
<span></span>
<span><span class="co"># set option</span></span>
<span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">99999</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>max.print <span class="op">=</span> <span class="fl">99999</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Next we define a coordinate reference system (CRS) for spatial
analysis and create a base map for later use. The CRS uses the USA
Contiguous Albers Equal-Area Conic projection, and is identified by the
EPSG code 6703. We modify the CRS slightly to have units of kilometers,
so that distances between widespread count sites are not especially
large numbers (Krainski et al. 2018).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a crs</span></span>
<span><span class="va">epsg6703km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5"</span>,</span>
<span>  <span class="st">"+lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83"</span>,</span>
<span>  <span class="st">"+units=km +no_defs"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a base map</span></span>
<span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"state"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"texas"</span>, <span class="st">"oklahoma"</span>, <span class="st">"kansas"</span>, <span class="st">"missouri"</span>,</span>
<span>    <span class="st">"arkansas"</span>, <span class="st">"louisiana"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">epsg6703km</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="import-data">Import data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h2>
<p>Next we import some bird count data from the GitHub repository
associated with Meehan et al. (2019), and turn the data set into
spatially referenced points. We use a subset of the data (30 years, 6 US
states) for this analysis to reduce computing time (~ 1 min). Note that
site selection and zero filling, important components of trend analyses,
have already been conducted and this is the resulting data set.</p>
<p>The <code>inlabru</code> package contains a pregenerated version of
the data subset, called <code>robins_subset</code>, that can be accessed
with <code>data(robins_subset)</code>, to avoid accessing the full data
online. The following code was used to generate the subset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">robins_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.github.com/tmeeha/inlaSVCBC"</span>,</span>
<span>  <span class="st">"/master/code/modeling_data.csv"</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">circle</span>, <span class="va">bcr</span>, <span class="va">state</span>, <span class="va">year</span>, <span class="va">std_yr</span>, <span class="va">count</span>, <span class="va">log_hrs</span>,</span>
<span>    <span class="va">lon</span>, <span class="va">lat</span>, <span class="va">obs</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">year</span> <span class="op">+</span> <span class="fl">1899</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">state</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"TEXAS"</span>, <span class="st">"OKLAHOMA"</span>, <span class="st">"KANSAS"</span>, <span class="st">"MISSOURI"</span>,</span>
<span>      <span class="st">"ARKANSAS"</span>, <span class="st">"LOUISIANA"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">1987</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We load the data, filter out observation sites with less than 20
years of data, add index variables to uniquely index site and year
information, and transform the coordinates to the
<code>epsg6703km</code> CRS:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">robins_subset</span><span class="op">)</span></span>
<span><span class="va">count_dat</span> <span class="op">&lt;-</span> <span class="va">robins_subset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>site_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">circle</span>, <span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">site_idx</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_years <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_years</span> <span class="op">&gt;=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    std_yr <span class="op">=</span> <span class="va">year</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>    obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    site_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">circle</span>, <span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    year_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    site_year_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">circle</span>, <span class="va">lon</span>, <span class="va">lat</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">epsg6703km</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    easting <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>    northing <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">circle</span>, <span class="va">year</span><span class="op">)</span></span></code></pre></div>
<p>A rough view of changes in robin relative abundance, which does not
account for variation in count effort, can be seen by plotting raw
counts per site and year.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># map it</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">count_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year_idx</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">30</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">count</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">states</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>datum <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="svc_files/figure-html/data_map-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="make-spatial-data">Make spatial data<a class="anchor" aria-label="anchor" href="#make-spatial-data"></a>
</h2>
<p>Next we use the count data to make a map of distinct count sites and
save the coordinates of the sites, unique and across all years, for
later spatial modeling and plotting.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make a set of distinct study sites for mapping</span></span>
<span><span class="va">site_map</span> <span class="op">&lt;-</span> <span class="va">count_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">circle</span>, <span class="va">easting</span>, <span class="va">northing</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">circle</span>, <span class="va">easting</span>, <span class="va">northing</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="spde-components">SPDE components<a class="anchor" aria-label="anchor" href="#spde-components"></a>
</h2>
<p>Computing a continuous-space model with <code>R-INLA</code> using the
SPDE approach requires construction of four distinct sets of data and
model objects (Blangiardo and Cameletti 2015, Krainski et al. 2018).
First, we create a <strong>modeling mesh</strong>, which is used to
provide a piecewise linear representation of the continuous spatial
surface, based on a triangulation of the modeled region. Here, the same
mesh will get reused for each of the spatial terms in the model. Second,
we construct an <strong>SPDE model object</strong> that specifies
properties of the spatial model. Again, we will use the same SPDE object
for each of the spatial terms in the model.</p>
<p>In plain <code>R-INLA</code>, we would also need to create index
vectors and projector matrices (or <strong>A matrices</strong> as they
are often called). However, in <code>inlabru</code>, these objects are
created automatically, and the user does not need to deal with them
directly. This works by an automatic creation of a
<code>bru_mapper</code> object that knows how to map between mesh nodes
and spatial data locations. Thus, the only two <code>R-INLA</code>
functions needed in the user code of the SPDE modelling steps are
<code><a href="https://inlabru-org.github.io/fmesher/reference/fm_mesh_2d.html" class="external-link">fm_mesh_2d_inla()</a></code> and <code><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.pcmatern.html" class="external-link">inla.spde2.pcmatern()</a></code>,
and the <code><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.index.html" class="external-link">inla.spde.make.index()</a></code> and
<code><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.A.html" class="external-link">inla.spde.make.A()</a></code> functions are only called internally by
the <code>inlabru</code> code itself, or rather
<code><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluator()</a></code> is used instead.</p>
</div>
<div class="section level2">
<h2 id="modeling-mesh">Modeling mesh<a class="anchor" aria-label="anchor" href="#modeling-mesh"></a>
</h2>
<p>There are various things to consider when constructing a mesh
(Lindgren and Rue 2015, Blangiardo and Cameletti 2015, Krainski et
al. 2018, Bakka et al. 2018). In constructing one, we balance a
trade-off between capturing fine-scaled features of the Gaussian random
field and computing times. Here, we create two non-convex hulls around
the count sites, and then build a triangular mesh by specifying minimum
and maximum edge lengths within the inner hull, and within the slightly
larger outer hull.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make a two extension hulls and mesh for spatial model</span></span>
<span><span class="va">hull</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_nonconvex_hull.html" class="external-link">fm_extensions</a></span><span class="op">(</span></span>
<span>  <span class="va">count_dat</span>,</span>
<span>  convex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>  concave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">350</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_mesh_2d.html" class="external-link">fm_mesh_2d_inla</a></span><span class="op">(</span></span>
<span>  boundary <span class="op">=</span> <span class="va">hull</span>, max.edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">600</span><span class="op">)</span>, <span class="co"># km inside and outside</span></span>
<span>  cutoff <span class="op">=</span> <span class="fl">50</span>, offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">300</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="va">count_dat</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="co"># cutoff is min edge</span></span>
<span></span>
<span><span class="co"># plot it</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mesh</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">site_map</span>, col <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">states</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="svc_files/figure-html/mesh-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="spde-model-object">SPDE model object<a class="anchor" aria-label="anchor" href="#spde-model-object"></a>
</h2>
<p>Next we create an SPDE object to define the model smoothness, with
prior distributions for the variance and range parameters, and the mesh.
Here we assume a Gaussian random field characterized with a Matérn
covariance function with penalized complexity priors (Simpson et
al. 2017) for the practical range (distance where spatial correlation
approaches 0.1) and variation explained by the function (Fuglstad et
al. 2019). The prior for the spatial range is set such that the
probability of a range exceeding 500 km is 0.5. The prior for the
variance explained by the spatial effect is set such that the
probability of a standard deviation exceeding 1 is 0.5 (Krainski et
al. 2018). If one wants to constrain this kind of spatial effect to
integrate to zero, <code>constr=TRUE</code> should be added at this
stage.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make spde</span></span>
<span><span class="va">spde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.pcmatern.html" class="external-link">inla.spde2.pcmatern</a></span><span class="op">(</span></span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  prior.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  prior.sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="weighted-spatial-effects-in-inlabru">Weighted spatial effects in inlabru<a class="anchor" aria-label="anchor" href="#weighted-spatial-effects-in-inlabru"></a>
</h2>
<p>In ordinary <code>R-INLA</code>, it would be necessary to construct
projector matrices for each model component, that would include the
different covariate weightings for each spatial model component. In
<code>inlabru</code>, this can instead be handled by either explicitly
multiplying the spatial random fields with the spatial covariates in the
model formula expression, or by specifying the <code>weights</code>
argument for each model component specification. We will here use the
latter approach, since it is the easiest.</p>
<p>In our model,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\epsilon_s</annotation></semantics></math>
is a spatially varying effect of the log of count effort. Similarly,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\tau_s</annotation></semantics></math>
is a spatially varying effect of year, so standardized year (with 1987 =
0) is also specified in the <code>weights</code> argument.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\alpha_s</annotation></semantics></math>
is also an SVC, but it is a spatially varying intercept. For intercepts
it is not necessary to specify a constant weight of 1. The model
component
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>κ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\kappa_{s}</annotation></semantics></math>
is linked to each observation site and is not modeled on the mesh.</p>
<p>Note that the current use of the term ‘weights’ is different from
that often encountered when defining mixed effect models in
<code>R</code>. Here it is used to define covariate value
multiplication, as opposed to <strong>importance values</strong> for
likelihoods in other contexts.</p>
<div class="section level3">
<h3 id="data-stack-for-model-fitting">Data stack for model fitting<a class="anchor" aria-label="anchor" href="#data-stack-for-model-fitting"></a>
</h3>
<p>In plain <code>R-INLA</code>, we would need to bundle all the model
data and component projector matrix information using the
<code><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack()</a></code> function. In <code>inlabru</code>, this is
done automatically, so we skip that step.</p>
</div>
</div>
<div class="section level2">
<h2 id="model-formula">Model formula<a class="anchor" aria-label="anchor" href="#model-formula"></a>
</h2>
<p>The last required input for the analysis is the model formula, which
includes information on the prior for explained variation for the
unstructured random intercept. We define the prior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>κ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\kappa_s</annotation></semantics></math>
as a penalized complexity prior (Simpson et al. 2017), set such that the
probability of the standard deviation associated with the random effect
exceeding 1 is 0.01.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># iid prior</span></span>
<span><span class="va">pc_prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pcprec"</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Notice that if one wants to constrain a spatial spde effect to
integrate to zero, it should be added <code>constr=TRUE</code> in the
SPDE model definition rather than in the component definition. As we
want to constrain
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>κ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\kappa_s</annotation></semantics></math>
and it is a non-spatial term we <strong>can</strong> use
<code>constr=TRUE</code> in its corresponding <code>label()</code>
component definition below, which imposes a sum-to-zero constraint.</p>
<p>The model described above is translated to <code>inlabru</code>
modeling syntax as:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># components</span></span>
<span><span class="va">svc_components</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/kappa.html" class="external-link">kappa</a></span><span class="op">(</span><span class="va">site_idx</span>, model <span class="op">=</span> <span class="st">"iid"</span>, constr <span class="op">=</span> <span class="cn">TRUE</span>, hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="va">pc_prec</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="va">geometry</span>, model <span class="op">=</span> <span class="va">spde</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">eps</span><span class="op">(</span><span class="va">geometry</span>, weights <span class="op">=</span> <span class="va">log_hrs</span>, model <span class="op">=</span> <span class="va">spde</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tau</span><span class="op">(</span><span class="va">geometry</span>, weights <span class="op">=</span> <span class="va">std_yr</span>, model <span class="op">=</span> <span class="va">spde</span><span class="op">)</span></span>
<span><span class="co"># formula, with "." meaning "add all the model components":</span></span>
<span><span class="va">svc_formula</span> <span class="op">&lt;-</span> <span class="va">count</span> <span class="op">~</span> <span class="va">.</span></span></code></pre></div>
<p>Specifying the <code>sf</code> column <code>geometry</code> as input
causes <code>inlabru</code> to extract the spatial coordinate
information for the observation locations from. Alternatively, we could
specify the function <code>st_coordinates</code> instead, but that would
extract the raw coordinates, potentially losing important coordinate
reference system information. Alternatively, we can specify that
CRS-free information explicitly as input, with
<code>cbind(easting, northing)</code> or
<code>st_coordinates(.data.)</code>.</p>
<p>Here, we define the response as <code>count</code>, remove the
automatic global intercept with a <code>-1</code>, and then specify the
other terms in the model with <code>label()</code> statements. The first
<code><a href="https://rdrr.io/r/base/kappa.html" class="external-link">kappa()</a></code> statement defines
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>κ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\kappa_s</annotation></semantics></math>,
the site effect, as a normally distributed and independent
(<code>model="iid"</code>), globally zero-centred (sum to zero
<code>constr=TRUE</code>), deviation from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\alpha_s</annotation></semantics></math>.
The second <code><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha()</a></code> statement defines
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\alpha_s</annotation></semantics></math>
as a spatially varying intercept with spatial structure described by the
SPDE object called ‘spde’. Remember that if one wants to constrain this
kind of spatial effect to integrate to zero, <code>constr=TRUE</code>
should be added in the SPDE model definition rather than in the
<code>label()</code> arguments. The third <code>eps()</code> statement
defines
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\epsilon_s</annotation></semantics></math>
as an SVC for the effect of count effort, with spatial structure also
described by the SPDE object. The weights for this spatially structured
random slope are specified with the <code>weights=log_hrs</code>
argument. The fourth <code>tau()</code> statement defines
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\tau_s</annotation></semantics></math>
as an SVC for the year effect, with spatial structure described in the
SPDE object. The weights for this spatially structured random slope are
specified with the <code>weights=std_yr</code> argument.</p>
</div>
<div class="section level2">
<h2 id="run-model">Run model<a class="anchor" aria-label="anchor" href="#run-model"></a>
</h2>
<p>We estimate the model with a call to <code><a href="../reference/bru.html">bru()</a></code>. First we set
the option to use the (new) experimental way to do internal
computations, see Van Niekerk et. al. (2022), for the sake of computing
speed and better numerics. In the call to <code><a href="../reference/bru.html">bru()</a></code>, we give
the model components, and specify an observation likelihood with the
model formula for the negative binomial distribution for the counts, and
define the estimation data. Then we ask <code><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla()</a></code> to compute
WAIC and CPO (temporarily disabled) to evaluate model fit (also, to save
the information necessary for posterior sampling we need
<code>config=TRUE</code>, but this is automatically set by
<code><a href="../reference/bru.html">bru()</a></code>, as <code><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">inlabru::predict()</a></code> relies on it for
posterior sampling and prediction). For computing speed, we choose to
use the simplified Laplace approximation strategy and Empirical Bayes
estimation. The <code><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla()</a></code> run for this model takes about 1
minutes on a standard laptop computer. Another option is to use the
Variational Bayes approximation as detailed in Van Niekerk and Rue
(2021) and Van Niekerk et. al. (2022).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bru.html">bru</a></span><span class="op">(</span></span>
<span>  <span class="va">svc_components</span>,</span>
<span>  <span class="fu"><a href="../reference/bru_like.html">like</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">svc_formula</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"nbinomial"</span>,</span>
<span>    data <span class="op">=</span> <span class="va">count_dat</span></span>
<span>  <span class="op">)</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>waic <span class="op">=</span> <span class="cn">TRUE</span>, cpo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    control.inla <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>int.strategy <span class="op">=</span> <span class="st">"eb"</span><span class="op">)</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-summaries">Model summaries<a class="anchor" aria-label="anchor" href="#model-summaries"></a>
</h2>
<p>Once computation is complete, we look at the initial results to see
how things went. First we check the posterior means for the
hyperparameters of the model, mainly the variance components and the
spatial ranges of the spatially structured parameters.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># view results</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">summary.hyperpar</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;                              mean            sd</span></span>
<span><span class="co">#&gt; Precision for kappa    2.32216030    0.45217793</span></span>
<span><span class="co">#&gt; Range for alpha      934.19573570  276.73025298</span></span>
<span><span class="co">#&gt; Stdev for alpha        2.01791277    0.41589740</span></span>
<span><span class="co">#&gt; Range for eps       6126.73006859 5046.52536467</span></span>
<span><span class="co">#&gt; Stdev for eps          0.40082168    0.14765747</span></span>
<span><span class="co">#&gt; Range for tau        691.19199931  238.99776312</span></span>
<span><span class="co">#&gt; Stdev for tau          0.06392553    0.01251372</span></span></code></pre></div>
<p>Next we examine some summaries of the random effect estimates,
starting with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>s</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(\alpha_s)</annotation></semantics></math>,
which is effort-corrected relative abundance at year = 0 (1987), given 1
hour of count effort (i.e., log[1]=0).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">alp</span><span class="op">$</span><span class="st">"0.5quant"</span><span class="op">)</span><span class="op">)</span> <span class="co"># exp(alpha) posterior median</span></span>
<span><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span><span class="co">#&gt;  0.03232  0.94610  3.04093  6.80870  8.11526 57.44233</span></span></code></pre></div>
<p>Note that to avoid issues due to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>≠</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="false" form="prefix">|</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">E[\exp(x)|y]\neq\exp[E(x|y)]</annotation></semantics></math>,
we use the posterior median instead of the posterior mean.</p>
<p>The summary for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\epsilon_s</annotation></semantics></math>
shows variation in the exponent for the effort correction function
across space.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">eps</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span> <span class="co"># epsilon</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;  0.6845  0.8784  0.9952  0.9851  1.0618  1.3375</span></span></code></pre></div>
<p>The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\tau_s</annotation></semantics></math>
summary shows how long-term, log-linear trends of robin relative
abundance have varied across space, from annual decreases of around 10%
to annual increases of around 10%.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">tau</span><span class="op">$</span><span class="st">"0.5quant"</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># (exp(tau)-1)*100</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt; -13.306  -5.245  -1.843  -1.199   2.551  11.429</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="svc-maps">SVC maps<a class="anchor" aria-label="anchor" href="#svc-maps"></a>
</h2>
<p>Next we create maps of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\alpha_s</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\epsilon_s</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\tau_s</annotation></semantics></math>
to inspect the spatial structure of these parameter estimates. We start
by creating a 25-km mapping grid, and then projecting this mapping grid
to the modeling mesh.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get easting and northing limits</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_bbox.html" class="external-link">fm_bbox</a></span><span class="op">(</span><span class="va">hull</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">grd_dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make mesh projector to get model summaries from the mesh to the mapping grid</span></span>
<span><span class="va">mesh_proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluator</a></span><span class="op">(</span></span>
<span>  <span class="va">mesh</span>,</span>
<span>  xlim <span class="op">=</span> <span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, ylim <span class="op">=</span> <span class="va">bbox</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, dims <span class="op">=</span> <span class="va">grd_dims</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then we populate the mapping grids with parameter estimates
(posterior median and range95), turn them into a raster stack, and mask
the raster stack to the study area.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pull data</span></span>
<span><span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">kappa</span><span class="op">$</span><span class="st">"0.5quant"</span><span class="op">)</span>,</span>
<span>  range95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">kappa</span><span class="op">$</span><span class="st">"0.975quant"</span><span class="op">)</span> <span class="op">-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">kappa</span><span class="op">$</span><span class="st">"0.025quant"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">alph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">alpha</span><span class="op">$</span><span class="st">"0.5quant"</span><span class="op">)</span>,</span>
<span>  range95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">alpha</span><span class="op">$</span><span class="st">"0.975quant"</span><span class="op">)</span> <span class="op">-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">alpha</span><span class="op">$</span><span class="st">"0.025quant"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">epsi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  median <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">eps</span><span class="op">$</span><span class="st">"0.5quant"</span>,</span>
<span>  range95 <span class="op">=</span> <span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">eps</span><span class="op">$</span><span class="st">"0.975quant"</span> <span class="op">-</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">eps</span><span class="op">$</span><span class="st">"0.025quant"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">taus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  median <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">tau</span><span class="op">$</span><span class="st">"0.5quant"</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>  range95 <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">tau</span><span class="op">$</span><span class="st">"0.975quant"</span><span class="op">)</span> <span class="op">-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">tau</span><span class="op">$</span><span class="st">"0.025quant"</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop to get estimates on a mapping grid</span></span>
<span><span class="va">pred_grids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">alph</span>, epsilon <span class="op">=</span> <span class="va">epsi</span>, tau <span class="op">=</span> <span class="va">taus</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluate</a></span><span class="op">(</span><span class="va">mesh_proj</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make a terra raster stack with the posterior median and range95</span></span>
<span><span class="va">out_stk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mean_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mesh_proj</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">mesh_proj</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,</span>
<span>    Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">pred_grids</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">grd_dims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">mean_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">mean_j</span>, crs <span class="op">=</span> <span class="va">epsg6703km</span><span class="op">)</span></span>
<span>  <span class="va">range95_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">mesh_proj</span><span class="op">$</span><span class="va">x</span>, Y <span class="op">=</span> <span class="va">mesh_proj</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,</span>
<span>    Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">pred_grids</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">grd_dims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">range95_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">range95_j</span>, crs <span class="op">=</span> <span class="va">epsg6703km</span><span class="op">)</span></span>
<span>  <span class="va">out_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mean_j</span>, <span class="va">range95_j</span><span class="op">)</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu">add</span><span class="op">(</span><span class="va">out_stk</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">out_j</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">out_stk</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"alpha_median"</span>, <span class="st">"alpha_range95"</span>, <span class="st">"epsilon_median"</span>,</span>
<span>  <span class="st">"epsilon_range95"</span>, <span class="st">"tau_median"</span>, <span class="st">"tau_range95"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">out_stk</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span></span>
<span>  <span class="va">out_stk</span>,</span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  updatevalue <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  touches <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, we plot the SVCs with the following code. We plot the
posterior median and 95% uncertainty width (“range95”) for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>κ</mi><mi>s</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(\kappa_s)</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>s</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(\alpha_s)</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\epsilon_s</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mrow><mo stretchy="true" form="prefix">(</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>τ</mi><mi>s</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">100(\exp(\tau_s)-1)</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_plot_field</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data_stk</span>, <span class="va">scale_label</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>datum <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_stk</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span><span class="va">scale_label</span>,</span>
<span>      palette <span class="op">=</span> <span class="st">"Spectral"</span>,</span>
<span>      na.value <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">make_plot_site</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scale_label</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>datum <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, size <span class="op">=</span> <span class="fl">1</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_distiller</a></span><span class="op">(</span><span class="va">scale_label</span>, palette <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># medians</span></span>
<span><span class="co"># fields alpha_s, epsilon_s, tau_s</span></span>
<span><span class="va">pa</span> <span class="op">&lt;-</span> <span class="fu">make_plot_field</span><span class="op">(</span></span>
<span>  data_stk <span class="op">=</span> <span class="va">out_stk</span><span class="op">[[</span><span class="st">"alpha_median"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  scale_label <span class="op">=</span> <span class="st">"posterior\nmedian\nexp(alpha_s)"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pe</span> <span class="op">&lt;-</span> <span class="fu">make_plot_field</span><span class="op">(</span></span>
<span>  data_stk <span class="op">=</span> <span class="va">out_stk</span><span class="op">[[</span><span class="st">"epsilon_median"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  scale_label <span class="op">=</span> <span class="st">"posterior\nmedian\nepsilon_s"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pt</span> <span class="op">&lt;-</span> <span class="fu">make_plot_field</span><span class="op">(</span></span>
<span>  data_stk <span class="op">=</span> <span class="va">out_stk</span><span class="op">[[</span><span class="st">"tau_median"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  scale_label <span class="op">=</span> <span class="st">"posterior\nmedian\n100(exp(tau_s)-1)"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># sites kappa_s</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu">make_plot_site</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">site_map</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">kappa</span><span class="op">$</span><span class="va">median</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  scale_label <span class="op">=</span> <span class="st">"posterior\nmedian\nexp(kappa_s)"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># range95</span></span>
<span><span class="co"># fields alpha_s, epsilon_s, tau_s</span></span>
<span><span class="va">pa_range95</span> <span class="op">&lt;-</span> <span class="fu">make_plot_field</span><span class="op">(</span></span>
<span>  data_stk <span class="op">=</span> <span class="va">out_stk</span><span class="op">[[</span><span class="st">"alpha_range95"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  scale_label <span class="op">=</span> <span class="st">"posterior\nrange95\nexp(alpha_s)"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pe_range95</span> <span class="op">&lt;-</span> <span class="fu">make_plot_field</span><span class="op">(</span></span>
<span>  data_stk <span class="op">=</span> <span class="va">out_stk</span><span class="op">[[</span><span class="st">"epsilon_range95"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  scale_label <span class="op">=</span> <span class="st">"posterior\nrange95\nepsilon_s"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pt_range95</span> <span class="op">&lt;-</span> <span class="fu">make_plot_field</span><span class="op">(</span></span>
<span>  data_stk <span class="op">=</span> <span class="va">out_stk</span><span class="op">[[</span><span class="st">"tau_range95"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  scale_label <span class="op">=</span> <span class="st">"posterior\nrange95\n100(exp(tau_s)-1)"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># sites kappa_s</span></span>
<span><span class="va">ps_range95</span> <span class="op">&lt;-</span> <span class="fu">make_plot_site</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">site_map</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">kappa</span><span class="op">$</span><span class="va">range95</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  scale_label <span class="op">=</span> <span class="st">"posterior\nrange95\nexp(kappa_s)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot together</span></span>
<span><span class="fu"><a href="../reference/multiplot.html">multiplot</a></span><span class="op">(</span><span class="va">ps</span>, <span class="va">pa</span>, <span class="va">pe</span>, <span class="va">pt</span>, cols <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="svc_files/figure-html/svc_plots-1.png" width="768" style="display: block; margin: auto;">
The map for the posterior mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\tau_s</annotation></semantics></math>
shows that robins have decreased in the southern part of the study area
and increased in the northern part. This demonstrates how the wintering
range of robins is shifting northward as winters become warmer due to
climate change.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot together</span></span>
<span><span class="fu"><a href="../reference/multiplot.html">multiplot</a></span><span class="op">(</span><span class="va">ps_range95</span>, <span class="va">pa_range95</span>, <span class="va">pe_range95</span>, <span class="va">pt_range95</span>, cols <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="svc_files/figure-html/svc_plots_range95-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="more-information">More information<a class="anchor" aria-label="anchor" href="#more-information"></a>
</h2>
<p>More information on building spatial models using the SPDE approach
in R-INLA can be found in Lindgren and Rue (2015), Blangiardo and
Camaletti (2015), Bakka et al. (2018), Krainski et al. (2018), and
Moraga (2019).</p>
</div>
<div class="section level2">
<h2 id="citations">Citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h2>
<p>Bakka, H., Rue, H., Fuglstad, G.A., Riebler, A., Bolin, D., Illian,
J., Krainski, E., Simpson, D. and Lindgren, F., 2018. Spatial modeling
with R‐INLA: A review. Wiley Interdisciplinary Reviews: Computational
Statistics, 10(6), p.e1443.</p>
<p>Besag, J., 1974. Spatial interaction and the statistical analysis of
lattice systems. Journal of the Royal Statistical Society: Series B
(Methodological), 36(2), pp.192-225.</p>
<p>Blangiardo, M., Cameletti, M., Baio, G. and Rue, H., 2013. Spatial
and spatio-temporal models with R-INLA. Spatial and spatio-temporal
epidemiology, 4, pp.33-49.</p>
<p>Finley, A.O., 2011. Comparing spatially‐varying coefficients models
for analysis of ecological data with non‐stationary and anisotropic
residual dependence. Methods in Ecology and Evolution, 2(2),
pp.143-154.</p>
<p>Fuglstad, G.A., Simpson, D., Lindgren, F. and Rue, H., 2019.
Constructing priors that penalize the complexity of Gaussian random
fields. Journal of the American Statistical Association, 114(525),
pp.445-452.</p>
<p>Gelfand, A.E., Kim, H.J., Sirmans, C.F. and Banerjee, S., 2003.
Spatial modeling with spatially varying coefficient processes. Journal
of the American Statistical Association, 98(462), pp.387-396.</p>
<p>Gómez-Rubio, V., 2020. Bayesian inference with INLA. CRC Press.</p>
<p>Krainski, E., Gómez-Rubio, V., Bakka, H., Lenzi, A., Castro-Camilo,
D., Simpson, D., Lindgren, F. and Rue, H., 2018. Advanced spatial
modeling with stochastic partial differential equations using R and
INLA. Chapman and Hall/CRC.</p>
<p>Lindgren, F., Rue, H. and Lindström, J., 2011. An explicit link
between Gaussian fields and Gaussian Markov random fields: the
stochastic partial differential equation approach. Journal of the Royal
Statistical Society: Series B (Statistical Methodology), 73(4),
pp.423-498.</p>
<p>Lindgren, F. and Rue, H., 2015. Bayesian spatial modelling with
R-INLA. Journal of statistical software, 63, pp.1-25.</p>
<p>Lindgren, F., Bolin, D. and Rue, H., 2022. The SPDE approach for
Gaussian and non-Gaussian fields: 10 years and still running. Spatial
Statistics, p.100599.</p>
<p>Link, W.A., Sauer, J.R. and Niven, D.K., 2006. A hierarchical model
for regional analysis of population change using Christmas Bird Count
data, with application to the American Black Duck. The Condor, 108(1),
pp.13-24.</p>
<p>Meehan, T.D., Michel, N.L. and Rue, H., 2019. Spatial modeling of
Audubon Christmas Bird Counts reveals fine‐scale patterns and drivers of
relative abundance trends. Ecosphere, 10(4), p.e02707.</p>
<p>Moraga, P., 2019. Geospatial health data: Modeling and visualization
with R-INLA and shiny. CRC Press.</p>
<p>R Core Team (2021). R: A language and environment for statistical
computing. R Foundation for Statistical Computing, Vienna, Austria.</p>
<p>Rue, H., Martino, S. and Chopin, N., 2009. Approximate Bayesian
inference for latent Gaussian models by using integrated nested Laplace
approximations. Journal of the royal statistical society: Series b
(statistical methodology), 71(2), pp.319-392.</p>
<p>Simpson, D., Rue, H., Riebler, A., Martins, T.G. and Sørbye, S.H.,
2017. Penalising model component complexity: A principled, practical
approach to constructing priors. Statistical science, 32(1),
pp.1-28.</p>
<p>Soykan, C.U., Sauer, J., Schuetz, J.G., LeBaron, G.S., Dale, K. and
Langham, G.M., 2016. Population trends for North American winter birds
based on hierarchical models. Ecosphere, 7(5), p.e01351.</p>
<p>Van Niekerk, J. and Rue, H., 2021. Correcting the Laplace Method with
Variational Bayes. Journal of Machine Learning Research, Under
review.</p>
<p>Van Niekerk, J. and Krainski, E. T. and Rustand, D. and Rue, H.,
2022. A new avenue for Bayesian inference with INLA. Submitted.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Finn Lindgren, Fabian E. Bachl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
