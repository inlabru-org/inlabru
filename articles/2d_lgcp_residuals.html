<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="inlabru">
<title>Residual Analysis of spatial point process models using Bayesian methods • inlabru</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Residual Analysis of spatial point process models using Bayesian methods">
<meta property="og:description" content="inlabru">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">inlabru</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.10.1.9011</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-general-examples">General examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-general-examples">
    <h6 class="dropdown-header" data-toc-skip>Basic examples</h6>
    <a class="dropdown-item" href="../articles/random_fields.html">Random field models in 1D</a>
    <a class="dropdown-item" href="../articles/random_fields_2d.html">Spatial random field models in 2D</a>
    <a class="dropdown-item" href="../articles/publications.html">Publications</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Concepts</h6>
    <a class="dropdown-item" href="../articles/component.html">Defining a model component</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Special models and techniques</h6>
    <a class="dropdown-item" href="../articles/svc.html">Spatially varying coefficient models</a>
    <a class="dropdown-item" href="../articles/zip_zap_models.html">ZIP and ZAP count models (zero-inflation)</a>
    <a class="dropdown-item" href="../articles/prediction_scores.html">Computing posterior prediction scores</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/articles.html">Full articles list</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-point-processes">Point processes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-point-processes">
    <h6 class="dropdown-header" data-toc-skip>Point process examples</h6>
    <a class="dropdown-item" href="../articles/1d_lgcp.html">LGCPs - An example in one dimension</a>
    <a class="dropdown-item" href="../articles/2d_lgcp.html">LGCPs - An example in two dimensions (sf version)</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_sp.html">LGCPs - An example in two dimensions (sp version)</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_covars.html">LGCPs - Spatial covariates</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_distancesampling.html">LGCPs - Distance sampling</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_plotsampling.html">LGCPs - Plot sampling</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_multilikelihood.html">LGCPs - Multiple likelihoods</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_spatiotemporal.html">LGCPs - An example in space and time</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_residuals.html">LGCPs - Residuals</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-technical-articles">Technical articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-technical-articles">
    <h6 class="dropdown-header" data-toc-skip>Mapper techniques</h6>
    <a class="dropdown-item" href="../articles/bru_mapper.html">Customised model component with the bru_mapper system</a>
    <a class="dropdown-item" href="../articles/mesh_mapping.html">Converting inla.spde.make.A calls to the bru_mapper system</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Theory and technical documentation</h6>
    <a class="dropdown-item" href="../articles/Apptainer.html">Installation of INLA and inlabru with Apptainer on HPC</a>
    <a class="dropdown-item" href="../articles/method.html">The iterative linearised inlabru method</a>
    <a class="dropdown-item" href="../articles/linearapprox.html">A nonlinear model approximation example</a>
    <a class="dropdown-item" href="../articles/devel_flow.html">Code internal flow diagrams for model evaluation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/inlabru-org/inlabru/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Residual Analysis of spatial point process models using Bayesian methods</h1>
                        <h4 data-toc-skip class="author">Niharika Reddy
Peddinenikalva</h4>
            
            <h4 data-toc-skip class="date">2024-06-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/inlabru-org/inlabru/blob/HEAD/vignettes/articles/2d_lgcp_residuals.Rmd" class="external-link"><code>vignettes/articles/2d_lgcp_residuals.Rmd</code></a></small>
      <div class="d-none name"><code>2d_lgcp_residuals.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load function definitions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"misc"</span>, <span class="st">"2d_lgcp_residuals_functions.R"</span><span class="op">)</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"inlabru"</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Point processes are useful for spatial data analysis and have wide
applications in ecology, epidemiology, seismology, computational
neuroscience, etc. Residual analysis is an effective assessment method
for spatial point processes, which commonly takes a frequentist
approach.</p>
<p>In this vignette, we will calculate residuals of some of the models
from <a href="https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html" class="uri">https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html</a>
using a Bayesian approach to the residual methods in “Residual Analysis
for spatial point processes” (Baddeley et al).</p>
</div>
<div class="section level2">
<h2 id="theory-of-residuals-for-spatial-point-process-models">Theory of Residuals for Spatial point process models<a class="anchor" aria-label="anchor" href="#theory-of-residuals-for-spatial-point-process-models"></a>
</h2>
<p>Consider a spatial point pattern <span class="math inline">\(\mathbf{x} = \{x_1, \dots, x_n \}\)</span> of
<span class="math inline">\(n\)</span> points in a bounded region <span class="math inline">\(W\)</span> of <span class="math inline">\(\mathbb{R}^2\)</span>. For a model of a spatial
point process <span class="math inline">\(\mathbf{X}\)</span> with
probability density <span class="math inline">\(f_{\theta}\)</span> and
parameter <span class="math inline">\(\theta\)</span>, the innovation
process of the model is defined by <span class="math display">\[\begin{equation}\label{eq:innovations}
    I_{\theta}(B) = n(\mathbf{X} \cap B) - \int_B \lambda_{\theta} (u)
\, du
\end{equation}\]</span> Here, <span class="math inline">\(\int_B
\lambda_{\theta}(u) \, du\)</span> is the expected number of points of
the fitted model in the bounded subset of <span class="math inline">\(B\)</span>. Innovations satisfy <span class="math inline">\(\mathbb{E}_{\theta} \left[ I_{\theta}(B)\right] =
0\)</span> .</p>
<p>Given data <span class="math inline">\(\mathbf{x}\)</span> of the
model and that the parameter estimate is <span class="math inline">\(\hat{\theta}\)</span>, the raw residuals are given
by <span class="math display">\[\begin{equation}\label{eq:raw residuals}
    R_{\hat{\theta}}(B) = n(\mathbf{x} \cap B) - \int_B \hat{\lambda}(u)
\,du
\end{equation}\]</span></p>
<p>Increments of the innovation process <span class="math inline">\(I\)</span> and raw residuals of the Poisson
processes <span class="math inline">\(R\)</span> are analogous to errors
and raw residuals of linear models respectively.</p>
<div class="section level3">
<h3 id="types-of-residuals">Types of Residuals<a class="anchor" aria-label="anchor" href="#types-of-residuals"></a>
</h3>
<p>We can scale the raw residual by scaling the increments of <span class="math inline">\(R_{\hat{\theta}}\)</span>. \ The <span class="math inline">\(h\)</span>-weighted innovations are given by <span class="math display">\[\begin{equation}\label{eq:h innovations}
    I(B, h, \lambda) = \sum_{x_i \in \mathbf{X} \cap B} h(x_i) -
    \int_B h(u) \lambda(u) \,du
\end{equation}\]</span> This leads to the <span class="math inline">\(h\)</span>-weighted residuals <span class="math display">\[\begin{equation}
\label{eq:h residuals}
    R(B, \hat{h}, \hat{\theta}) = I(B, \hat{h}, \hat{\lambda}) =
    \sum_{x_i \in \mathbf{x} \cap B} h(x_i) - \int_B \hat{h}(u)
\hat{\lambda}(u)\,du
\end{equation}\]</span> Since the innovation has mean 0, a true model
would yield <span class="math display">\[
\mathbb{E}\left[R(B, \hat{h}, \hat{\theta})\right] \approx 0.
\]</span> Changing the choice of the weight function <span class="math inline">\(h\)</span>, yields different types of
residuals.</p>
<div class="section level4">
<h4 id="scaling-residuals">Scaling Residuals<a class="anchor" aria-label="anchor" href="#scaling-residuals"></a>
</h4>
By taking <span class="math inline">\(h(u) = \mathbf{1} \{ u \in
B\}\)</span>, we get the raw residuals:
<span class="math display">\[\begin{aligned}
    R(B, \hat{h}, \hat{\theta}) &amp; = I(B, \hat{h}, \hat{\lambda}) =
    \sum_{x_i \in \mathbf{x} \cap B}h(x_i) - \int_B
\hat{h}(u)\hat{\lambda}(u)\,du\\
    &amp; = n(\mathbf{x} \cap B) - \int_B \hat{\lambda}(u) \,du
\end{aligned}\]</span>
</div>
<div class="section level4">
<h4 id="inverse-residuals">Inverse Residuals<a class="anchor" aria-label="anchor" href="#inverse-residuals"></a>
</h4>
By taking <span class="math inline">\(h(u) = \frac{1}{\lambda
(u)}\)</span>, we may encounter the case where <span class="math inline">\(\lambda(u) = 0\)</span>. The GNZ-formula <span class="math display">\[\begin{equation}
\mathbb{E}\left[ \sum_{x_i \in \mathbf{X}} h(x_i)\right] =
\mathbb{E}\left[ \int_W h(u) \lambda(u) \,du \right],
\end{equation}\]</span> would still hold for the first terms of the
<span class="math inline">\(h\)</span>-weighted residuals to exist. If
we define <span class="math inline">\(h(u) \lambda(u) = 0\)</span> for
all <span class="math inline">\(u\)</span> such that <span class="math inline">\(\lambda(u) = 0\)</span>, then the second term of
<span class="math inline">\(h\)</span>-weighted residuals will also
exist and the inverse residual is given by
<span class="math display">\[\begin{aligned}
    R\left(B, \frac{1}{\hat{\lambda}}, \hat{\theta}\right) &amp; =
    \sum_{x_i \in \mathbf{x} \cap B} \hat{h}(x_i) -
    \int_B \hat{h}(u) \hat{\lambda}(u) \,du \\
    &amp; = \sum_{x_i \in \mathbf{x} \cap B}
\frac{1}{\hat{\lambda}(x_i)} -
    \int_B \mathbf{1} \{ x_i \in \mathbf{x} \} \,du
\end{aligned}\]</span>
</div>
<div class="section level4">
<h4 id="pearson-residuals">Pearson Residuals<a class="anchor" aria-label="anchor" href="#pearson-residuals"></a>
</h4>
By using <span class="math inline">\(h(u) =
\frac{1}{\sqrt{\lambda(u)}}\)</span>, the Pearson residual is given by
<span class="math display">\[\begin{aligned}
    R\left( B, \frac{1}{\sqrt{\hat{\lambda}}}, \hat{\theta} \right)
    &amp; = \sum_{x_i \in \mathbf{x} \cap B} \hat{h}(x_i) -
    \int_B \hat{h}(u) \hat{\lambda}(u) \,du \\
    &amp; = \sum_{x_i \in \mathbf{x} \cap B}
\frac{1}{\sqrt{\hat{\lambda}(x_i)}} -
    \int_B \sqrt{\hat{\lambda}(u)} \,du
\end{aligned}\]</span>
<p>Here, zero values of <span class="math inline">\(\hat{\lambda}(u)\)</span> do not cause any issues
with calculating residuals as we set <span class="math inline">\(\hat{h}(u) \hat{\lambda}(u) =
\sqrt{\hat{\lambda}(u)}\)</span> for all <span class="math inline">\(u\)</span>.</p>
<p>So the three types of residuals are: <span class="math display">\[\begin{eqnarray}
\text{Scaled:} \qquad &amp; R(B, \hat{h}, \hat{\theta}) &amp; =
n(\mathbf{x} \cap B) -
\int_B \hat{\lambda}(u) \,du \\
\text{Inverse:} \qquad &amp; R\left(B, \frac{1}{\hat{\lambda}},
\hat{\theta}\right)
&amp; = \sum_{x_i \in \mathbf{x} \cap B} \frac{1}{\hat{\lambda}(x_i)} -
\int_B \mathbf{1} \{ x_i \in \mathbf{x} \} \,du \\
\text{Pearson:} \qquad &amp;  R\left( B,
\frac{1}{\sqrt{\hat{\lambda}}},\hat{\theta} \right) &amp; = \sum_{x_i
\in \mathbf{x} \cap B} \frac{1}{\sqrt{\hat{\lambda}(x_i)}} -
\int_B \sqrt{\hat{\lambda}(u)} \,du
\end{eqnarray}\]</span></p>
<p>Note that <span class="math inline">\(\hat{\lambda}(u)\)</span> and
<span class="math inline">\(\hat{h}(u)\)</span> are estimates of <span class="math inline">\(\lambda (u)\)</span> and <span class="math inline">\(h(u)\)</span> respectively</p>
</div>
</div>
<div class="section level3">
<h3 id="motivation-for-choice-of-residuals">Motivation for choice of residuals<a class="anchor" aria-label="anchor" href="#motivation-for-choice-of-residuals"></a>
</h3>
<p>The scaling residuals are nothing but the raw residuals and hence
depict the residual data as is. However, the Pearson residuals use a
weighted function <span class="math inline">\(h(u) =
\frac{1}{\lambda(u)}\)</span> so this helps to obtain normalised
residuals since the denominator accounts for variance of the residuals
and hence makes it reliable for any sample size.</p>
<p>The use of the inverse residual in this project is less clear.
However, we do know that it is easier to compute this residual since we
have the GNZ formula to estimate the value of $h(u) = for any value
<span class="math inline">\(\lambda(u)\)</span>.</p>
<p>For notation’s sake in this discussion, let <span class="math inline">\(h_{s}(u), h_{i}(u), h_p(u)\)</span> indicate the
weight function for scaling, inverse and Pearson residuals respectively.
Then, <span class="math inline">\(h_s(u) = \mathbf{1}\{u \in B\}, h_i(u)
= \frac{1}{\lambda(u)}, h_p(u) = \frac{1}{\sqrt{\lambda(u)}}\)</span>.
We can also see that <span class="math inline">\(h_s(u) =
\left(h_i(u)\right)^0\)</span> and <span class="math inline">\(h_p(u) =
\left(h_i(u)\right)^{1/2}\)</span>, so the values of the Pearson
residuals would lie somewhere between the other two residuals. So, in
our case, the inverse residuals would not be very useful, but we do find
that they are easier to compute by hand in terms of estimates.</p>
</div>
</div>
<div class="section level2">
<h2 id="computation-of-residuals">Computation of Residuals<a class="anchor" aria-label="anchor" href="#computation-of-residuals"></a>
</h2>
<p>In this vignette, the residuals of some models from <a href="https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html" class="uri">https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html</a>
are computed using a Bayesian approach of the residuals described above.
This is done using the <code>inlabru</code> package. The models used
are:</p>
<ul>
<li><p>Model 1 (Vegetation Model): The model is defined such that the
gorilla nests have vegetation type as a fixed covariate.</p></li>
<li><p>Model 2 (Elevation Model): The model is defined such that the
gorilla nests have elevation as a continuous variable.</p></li>
<li><p>Model 3 (Intercept Model): The model is defined such that the
gorilla nests have a constant effect.</p></li>
<li><p>Model 4 (SPDE Smooth type model): The model is defined such that
the gorilla nests depend on an SPDE type smooth function.</p></li>
</ul>
<p>The functions used to calculate the residuals of these models are
given in the Code appendix at the end of this vignette.</p>
<div class="section level3">
<h3 id="loading-gorillas-data">Loading gorillas data<a class="anchor" aria-label="anchor" href="#loading-gorillas-data"></a>
</h3>
<p>This vignette uses the <code>gorillas</code> dataset from the
“inlabru” package in R for modelling spatial Poisson processes. Here,
the ``inlabru” package uses Latent Gaussian Cox Processes to model the
data using different model definitions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">gorillas</span>, package <span class="op">=</span> <span class="st">"inlabru"</span><span class="op">)</span></span>
<span><span class="va">nests</span> <span class="op">&lt;-</span> <span class="va">gorillas</span><span class="op">$</span><span class="va">nests</span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="va">gorillas</span><span class="op">$</span><span class="va">mesh</span></span>
<span><span class="va">boundary</span> <span class="op">&lt;-</span> <span class="va">gorillas</span><span class="op">$</span><span class="va">boundary</span></span>
<span><span class="va">gcov</span> <span class="op">&lt;-</span> <span class="va">gorillas</span><span class="op">$</span><span class="va">gcov</span></span></code></pre></div>
<p>Initially, the set <span class="math inline">\(B\)</span> is defines
as <span class="math inline">\(B=W\)</span>, where <span class="math inline">\(W\)</span> is the object <code>boundary</code>.
The function <code>prepare_residual_calculations()</code> is defined to
compute a data frame of observations <span class="math inline">\(x_i\)</span> and sample points <span class="math inline">\(u \in W\)</span> to compute the residual, a matrix
<code>A_sum</code> that helps to calculate the summation term of the
residual and a matrix <code>A_integrate</code> that helps to calculate
the integral term of the residual.</p>
<p>The function <code>residual_df</code> is defined to compute all three
types of residuals for a given model and choice of <span class="math inline">\(B\)</span> given a set of observations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the subset B</span></span>
<span><span class="va">B</span> <span class="op">&lt;-</span> <span class="va">boundary</span></span>
<span></span>
<span><span class="co"># Store the required matrices and data frames for residual computation</span></span>
<span><span class="va">As</span> <span class="op">&lt;-</span> <span class="fu">prepare_residual_calculations</span><span class="op">(</span></span>
<span>  samplers <span class="op">=</span> <span class="va">B</span>, domain <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  observations <span class="op">=</span> <span class="va">nests</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="assessing-4-models-with-residuals">Assessing 4 models with residuals<a class="anchor" aria-label="anchor" href="#assessing-4-models-with-residuals"></a>
</h3>
<div class="section level4">
<h4 id="vegetation-model">Vegetation Model<a class="anchor" aria-label="anchor" href="#vegetation-model"></a>
</h4>
<p>This model is taken from <a href="https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html" class="uri">https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html</a>
. The model is defined such that the gorilla nests have vegetation type
as a fixed covariate.</p>
<p>The code chunk below shows how the model is defined by
<code><a href="../reference/lgcp.html">lgcp()</a></code> and also displays the model in the form of a plot.
The residuals of the model are also computed where <span class="math inline">\(B = W\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the vegetation model</span></span>
<span><span class="va">comp1</span> <span class="op">&lt;-</span> <span class="va">coordinates</span> <span class="op">~</span></span>
<span>  <span class="fu">vegetation</span><span class="op">(</span><span class="va">gcov</span><span class="op">$</span><span class="va">vegetation</span>, model <span class="op">=</span> <span class="st">"factor_contrast"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lgcp.html">lgcp</a></span><span class="op">(</span><span class="va">comp1</span>, <span class="va">nests</span>,</span>
<span>  samplers <span class="op">=</span> <span class="va">boundary</span>,</span>
<span>  domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>coordinates <span class="op">=</span> <span class="va">mesh</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in normalizePath(inla.dir): path[1]="/tmp/RtmpJy6Gtu/filee57147fcacee":</span></span>
<span><span class="co">## No such file or directory</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display the model</span></span>
<span><span class="va">int1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit1</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_pixels.html" class="external-link">fm_pixels</a></span><span class="op">(</span><span class="va">mesh</span>, mask <span class="op">=</span> <span class="va">boundary</span>, format <span class="op">=</span> <span class="st">"sp"</span><span class="op">)</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">vegetation</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">int1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">boundary</span>, alpha <span class="op">=</span> <span class="fl">0</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">nests</span>, color <span class="op">=</span> <span class="st">"DarkGreen"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2d_lgcp_residuals_files/figure-html/veg-mod-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the residuals for the vegetation model</span></span>
<span><span class="va">veg_res</span> <span class="op">&lt;-</span> <span class="fu">residual_df</span><span class="op">(</span></span>
<span>  <span class="va">fit1</span>, <span class="va">As</span><span class="op">$</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">vegetation</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">As</span><span class="op">$</span><span class="va">A_sum</span>, <span class="va">As</span><span class="op">$</span><span class="va">A_integrate</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">edit_df</span><span class="op">(</span><span class="va">veg_res</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Type"</span>, <span class="st">"mean.mc_std_err"</span>, <span class="st">"sd.mc_std_err"</span>, <span class="st">"median"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="25%">
<col width="15%">
<col width="14%">
<col width="15%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">q0.025</th>
<th align="right">q0.5</th>
<th align="right">q0.975</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Scaling_Residuals</td>
<td align="right">-0.1532086</td>
<td align="right">28.667502</td>
<td align="right">-62.118983</td>
<td align="right">3.1144591</td>
<td align="right">47.378530</td>
</tr>
<tr class="even">
<td align="left">Inverse_Residuals</td>
<td align="right">0.4846828</td>
<td align="right">1.469944</td>
<td align="right">-2.528504</td>
<td align="right">0.3965099</td>
<td align="right">3.200066</td>
</tr>
<tr class="odd">
<td align="left">Pearson_Residuals</td>
<td align="right">0.8397416</td>
<td align="right">4.932431</td>
<td align="right">-9.229894</td>
<td align="right">1.1834025</td>
<td align="right">8.161532</td>
</tr>
</tbody>
</table>
<p>Note: The data frame produced by <code>residual_df()</code>
originally contains the columns <code>Type</code>,
<code>mean.mc_std_err</code>, <code>sd.mc_std_err</code> and
<code>median</code> which have been removed in all the tables in the
vignette to highlight only essential and non-recurring data. This
editing of the data frames is done by the function
<code>edit_df</code>.</p>
</div>
<div class="section level4">
<h4 id="elevation-model">Elevation model<a class="anchor" aria-label="anchor" href="#elevation-model"></a>
</h4>
<p>This model is also taken from <a href="https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html" class="uri">https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html</a>
. The model is defined such that the gorilla nests have elevation as a
continuous variable.</p>
<p>The code chunk below shows how the model is defined by
<code><a href="../reference/lgcp.html">lgcp()</a></code> and also displays the model in the form of a
plot.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the Elevation model</span></span>
<span><span class="va">comp2</span> <span class="op">&lt;-</span> <span class="va">coordinates</span> <span class="op">~</span> <span class="fu">elev</span><span class="op">(</span><span class="va">elev</span>, model <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">mySmooth</span><span class="op">(</span><span class="va">coordinates</span>, model <span class="op">=</span> <span class="va">matern</span><span class="op">)</span> <span class="op">+</span> <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lgcp.html">lgcp</a></span><span class="op">(</span><span class="va">comp2</span>, <span class="va">nests</span>,</span>
<span>  samplers <span class="op">=</span> <span class="va">boundary</span>,</span>
<span>  domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>coordinates <span class="op">=</span> <span class="va">mesh</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in normalizePath(inla.dir): path[1]="/tmp/RtmpJy6Gtu/filee5713a463b48":</span></span>
<span><span class="co">## No such file or directory</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display the model</span></span>
<span><span class="va">int2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">fit2</span>,</span>
<span>  <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_pixels.html" class="external-link">fm_pixels</a></span><span class="op">(</span><span class="va">mesh</span>, mask <span class="op">=</span> <span class="va">boundary</span>, format <span class="op">=</span> <span class="st">"sp"</span><span class="op">)</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">elev</span> <span class="op">+</span> <span class="va">mySmooth</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">int2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">boundary</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">nests</span>, shape <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2d_lgcp_residuals_files/figure-html/elev-mod-1.png" width="700"></p>
<p>The residuals of the model when <span class="math inline">\(B =
W\)</span> are given below:</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="15%">
<col width="14%">
<col width="14%">
<col width="15%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">q0.025</th>
<th align="right">q0.5</th>
<th align="right">q0.975</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Scaling_Residuals</td>
<td align="right">-28.427804</td>
<td align="right">23.678823</td>
<td align="right">-74.91810</td>
<td align="right">-27.760841</td>
<td align="right">14.707577</td>
</tr>
<tr class="even">
<td align="left">Inverse_Residuals</td>
<td align="right">-8.580393</td>
<td align="right">1.322553</td>
<td align="right">-10.81110</td>
<td align="right">-8.802839</td>
<td align="right">-5.827234</td>
</tr>
<tr class="odd">
<td align="left">Pearson_Residuals</td>
<td align="right">-11.443725</td>
<td align="right">3.230450</td>
<td align="right">-17.40707</td>
<td align="right">-11.609547</td>
<td align="right">-5.413720</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="intercept-model">Intercept Model<a class="anchor" aria-label="anchor" href="#intercept-model"></a>
</h4>
<p>This model is also taken from <a href="https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html" class="uri">https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html</a>
. The model is defined such that the gorilla nests have a constant
effect.</p>
<p>The code chunk below shows how the model is defined by
<code><a href="../reference/lgcp.html">lgcp()</a></code> and also displays the model in the form of a plot.
The residuals of the model are also computed where <span class="math inline">\(B = W\)</span>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the Intercept model</span></span>
<span><span class="va">comp3</span> <span class="op">&lt;-</span> <span class="va">coordinates</span> <span class="op">~</span> <span class="fu">Intercept</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.data.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lgcp.html">lgcp</a></span><span class="op">(</span><span class="va">comp3</span>, <span class="va">nests</span>,</span>
<span>  samplers <span class="op">=</span> <span class="va">boundary</span>,</span>
<span>  domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>coordinates <span class="op">=</span> <span class="va">mesh</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in normalizePath(inla.dir): path[1]="/tmp/RtmpJy6Gtu/filee5715d4292a3":</span></span>
<span><span class="co">## No such file or directory</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display the model</span></span>
<span><span class="va">int3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">fit3</span>,</span>
<span>  <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_pixels.html" class="external-link">fm_pixels</a></span><span class="op">(</span><span class="va">mesh</span>, mask <span class="op">=</span> <span class="va">boundary</span>, format <span class="op">=</span> <span class="st">"sp"</span><span class="op">)</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Intercept</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">int3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">boundary</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">nests</span>, shape <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2d_lgcp_residuals_files/figure-html/int-mod-1.png" width="700"></p>
<p>The residuals of the model when <span class="math inline">\(B =
W\)</span> are given below:</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">q0.025</th>
<th align="right">q0.5</th>
<th align="right">q0.975</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Scaling_Residuals</td>
<td align="right">-3.3526881</td>
<td align="right">25.4561406</td>
<td align="right">-51.924718</td>
<td align="right">0.4265085</td>
<td align="right">46.507492</td>
</tr>
<tr class="even">
<td align="left">Inverse_Residuals</td>
<td align="right">-0.0724578</td>
<td align="right">0.7752123</td>
<td align="right">-1.476438</td>
<td align="right">0.0131109</td>
<td align="right">1.539260</td>
</tr>
<tr class="odd">
<td align="left">Pearson_Residuals</td>
<td align="right">-0.5002306</td>
<td align="right">4.4380978</td>
<td align="right">-8.755774</td>
<td align="right">0.0747792</td>
<td align="right">8.460915</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="smooth-model">Smooth Model<a class="anchor" aria-label="anchor" href="#smooth-model"></a>
</h4>
<p>This model is also taken from <a href="https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html" class="uri">https://inlabru-org.github.io/inlabru/articles/2d_lgcp_covars.html</a>
. The model is defined such that the gorilla nests depend on an SPDE
type smooth function.</p>
<p>The code chunk below shows how the model is defined by
<code><a href="../reference/lgcp.html">lgcp()</a></code> and also displays the model in the form of a plot.
The residuals of the model are also computed where <span class="math inline">\(B = W\)</span>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the Smooth model</span></span>
<span><span class="va">comp4</span> <span class="op">&lt;-</span> <span class="va">coordinates</span> <span class="op">~</span> <span class="fu">mySmooth</span><span class="op">(</span><span class="va">coordinates</span>, model <span class="op">=</span> <span class="va">matern</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fit4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lgcp.html">lgcp</a></span><span class="op">(</span><span class="va">comp4</span>, <span class="va">nests</span>,</span>
<span>  samplers <span class="op">=</span> <span class="va">boundary</span>,</span>
<span>  domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>coordinates <span class="op">=</span> <span class="va">mesh</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in normalizePath(inla.dir): path[1]="/tmp/RtmpJy6Gtu/filee5716b21e845":</span></span>
<span><span class="co">## No such file or directory</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display the model</span></span>
<span><span class="va">int4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">fit4</span>,</span>
<span>  <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_pixels.html" class="external-link">fm_pixels</a></span><span class="op">(</span><span class="va">mesh</span>, mask <span class="op">=</span> <span class="va">boundary</span>, format <span class="op">=</span> <span class="st">"sp"</span><span class="op">)</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">mySmooth</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">int4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">boundary</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">nests</span>, shape <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2d_lgcp_residuals_files/figure-html/smooth-mod-1.png" width="700"></p>
<p>The residuals of the model when <span class="math inline">\(B =
W\)</span> are given below:</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="15%">
<col width="14%">
<col width="14%">
<col width="15%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">q0.025</th>
<th align="right">q0.5</th>
<th align="right">q0.975</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Scaling_Residuals</td>
<td align="right">-24.379724</td>
<td align="right">28.174360</td>
<td align="right">-78.58554</td>
<td align="right">-21.788548</td>
<td align="right">29.423276</td>
</tr>
<tr class="even">
<td align="left">Inverse_Residuals</td>
<td align="right">-8.923146</td>
<td align="right">1.375264</td>
<td align="right">-11.08510</td>
<td align="right">-9.036441</td>
<td align="right">-6.396778</td>
</tr>
<tr class="odd">
<td align="left">Pearson_Residuals</td>
<td align="right">-12.006531</td>
<td align="right">3.910483</td>
<td align="right">-18.78743</td>
<td align="right">-11.623700</td>
<td align="right">-4.689766</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="comparing-models">Comparing models<a class="anchor" aria-label="anchor" href="#comparing-models"></a>
</h4>
<p>Firstly, from the plots of the four models, we see that there are
visual similarities in what the Elevation and smooth models appear to
be. So, we would expect that these two models show similar trends in
residuals.</p>
</div>
</div>
<div class="section level3">
<h3 id="redefining-the-set-b">Redefining the set B<a class="anchor" aria-label="anchor" href="#redefining-the-set-b"></a>
</h3>
<p>Consider defining a new type of set <span class="math inline">\(B\)</span> which consists of two subpolygons
within the boundary. This is done by the <code>partition()</code>
function which divides a polygon into grids based on number of rows and
columns or by a desired resolution. The code chunk below demonstrates a
use of the function for dividing the polygon and calculating the
residuals for this choice of <span class="math inline">\(B\)</span>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a grid for B partitioned into two</span></span>
<span><span class="va">B1</span> <span class="op">&lt;-</span> <span class="fu">partition</span><span class="op">(</span>samplers <span class="op">=</span> <span class="va">boundary</span>, nrows <span class="op">=</span> <span class="fl">1</span>, ncols <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">B1</span>, main <span class="op">=</span> <span class="st">"Two partitions of B"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2d_lgcp_residuals_files/figure-html/partitioning-B-two-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">As1</span> <span class="op">&lt;-</span> <span class="fu">prepare_residual_calculations</span><span class="op">(</span></span>
<span>  samplers <span class="op">=</span> <span class="va">B1</span>, domain <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  observations <span class="op">=</span> <span class="va">nests</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Residuals for the vegetation model</span></span>
<span><span class="va">veg_res2</span> <span class="op">&lt;-</span> <span class="fu">residual_df</span><span class="op">(</span></span>
<span>  <span class="va">fit1</span>, <span class="va">As1</span><span class="op">$</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">vegetation</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">As1</span><span class="op">$</span><span class="va">A_sum</span>, <span class="va">As1</span><span class="op">$</span><span class="va">A_integrate</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">edit_df</span><span class="op">(</span><span class="va">veg_res2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Type"</span>, <span class="st">"mean.mc_std_err"</span>,</span>
<span>  <span class="st">"sd.mc_std_err"</span>, <span class="st">"median"</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="26%">
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">q0.025</th>
<th align="right">q0.5</th>
<th align="right">q0.975</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Scaling_Residuals.1</td>
<td align="right">43.091118</td>
<td align="right">17.2060066</td>
<td align="right">11.391437</td>
<td align="right">43.339651</td>
<td align="right">73.118802</td>
</tr>
<tr class="even">
<td align="left">Scaling_Residuals.2</td>
<td align="right">-43.010578</td>
<td align="right">11.0746924</td>
<td align="right">-64.396520</td>
<td align="right">-42.190663</td>
<td align="right">-23.626262</td>
</tr>
<tr class="odd">
<td align="left">Inverse_Residuals.1</td>
<td align="right">5.347575</td>
<td align="right">1.0054019</td>
<td align="right">3.377390</td>
<td align="right">5.384027</td>
<td align="right">7.199462</td>
</tr>
<tr class="even">
<td align="left">Inverse_Residuals.2</td>
<td align="right">-4.852570</td>
<td align="right">0.4105032</td>
<td align="right">-5.669943</td>
<td align="right">-4.887822</td>
<td align="right">-4.052449</td>
</tr>
<tr class="odd">
<td align="left">Pearson_Residuals.1</td>
<td align="right">15.618995</td>
<td align="right">2.8604638</td>
<td align="right">10.368412</td>
<td align="right">15.213451</td>
<td align="right">21.065190</td>
</tr>
<tr class="even">
<td align="left">Pearson_Residuals.2</td>
<td align="right">-14.790418</td>
<td align="right">1.7313594</td>
<td align="right">-18.261819</td>
<td align="right">-14.886337</td>
<td align="right">-11.427678</td>
</tr>
</tbody>
</table>
<p>Here, it can be seen that there are two lines of residual data for
each type of residual. This signifies that the <code>residual_df</code>
function has calculated residuals for each partition. To compare these
residuals effectively, a function <code>residual_plot()</code> is
defined that plots the residuals for each corresponding polygon of
<code>B</code>. This is discussed later in the vignette.</p>
<p>Another type of partitioning is considered with three sections of the
region and its residuals are as displayed below:
<img src="2d_lgcp_residuals_files/figure-html/partitioning-B-three-1.png" width="700"></p>
<table class="table">
<colgroup>
<col width="26%">
<col width="14%">
<col width="14%">
<col width="15%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">q0.025</th>
<th align="right">q0.5</th>
<th align="right">q0.975</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Scaling_Residuals.1</td>
<td align="right">70.297895</td>
<td align="right">8.8021109</td>
<td align="right">51.8180879</td>
<td align="right">69.676650</td>
<td align="right">86.288583</td>
</tr>
<tr class="even">
<td align="left">Scaling_Residuals.2</td>
<td align="right">-21.031092</td>
<td align="right">17.9671750</td>
<td align="right">-55.3584484</td>
<td align="right">-22.042803</td>
<td align="right">14.949339</td>
</tr>
<tr class="odd">
<td align="left">Scaling_Residuals.3</td>
<td align="right">-46.526675</td>
<td align="right">4.4174727</td>
<td align="right">-55.2315251</td>
<td align="right">-46.631383</td>
<td align="right">-36.377608</td>
</tr>
<tr class="even">
<td align="left">Inverse_Residuals.1</td>
<td align="right">2.974820</td>
<td align="right">0.8322749</td>
<td align="right">1.6759115</td>
<td align="right">2.845902</td>
<td align="right">4.975778</td>
</tr>
<tr class="odd">
<td align="left">Inverse_Residuals.2</td>
<td align="right">3.024169</td>
<td align="right">0.8089525</td>
<td align="right">1.7614783</td>
<td align="right">2.924675</td>
<td align="right">4.917442</td>
</tr>
<tr class="even">
<td align="left">Inverse_Residuals.3</td>
<td align="right">-5.447642</td>
<td align="right">0.0590679</td>
<td align="right">-5.5203840</td>
<td align="right">-5.460253</td>
<td align="right">-5.295619</td>
</tr>
<tr class="odd">
<td align="left">Pearson_Residuals.1</td>
<td align="right">11.689063</td>
<td align="right">1.9741203</td>
<td align="right">8.0156840</td>
<td align="right">11.591375</td>
<td align="right">16.061618</td>
</tr>
<tr class="even">
<td align="left">Pearson_Residuals.2</td>
<td align="right">4.679755</td>
<td align="right">2.4651969</td>
<td align="right">-0.3197989</td>
<td align="right">4.502039</td>
<td align="right">10.181352</td>
</tr>
<tr class="odd">
<td align="left">Pearson_Residuals.3</td>
<td align="right">-15.266985</td>
<td align="right">0.8587115</td>
<td align="right">-16.7795826</td>
<td align="right">-15.371621</td>
<td align="right">-13.379088</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="residuals-of-models-at-different-resolutions">Residuals of models at different resolutions<a class="anchor" aria-label="anchor" href="#residuals-of-models-at-different-resolutions"></a>
</h3>
<p>Consider two more resolutions of <span class="math inline">\(B\)</span>, given in the plots below. Here we use
the <code>resolution</code> argument instead of <code>nrow</code> and
<code>ncol</code>. Due to the way <code><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">terra::rast()</a></code> interprets
the arguments, using <code>resolution</code> doesn’t guarantee complete
coverage of the <code>samplers</code> polygon.
<img src="2d_lgcp_residuals_files/figure-html/more-resolutions-1.png" width="700"><img src="2d_lgcp_residuals_files/figure-html/more-resolutions-2.png" width="700"></p>
<p>Using these two new choices of <span class="math inline">\(B\)</span>, the residuals are calculated for all
four models at both resolutions using <code>residual_df()</code>.</p>
<p>The functions <code>set_csc()</code> and <code>residual_plot()</code>
are defined to plot the three types of residuals for the model for each
partition in <span class="math inline">\(B\)</span>. The code chunk
below demonstrates how this plotting is done for the vegetation model at
resolution <span class="math inline">\(B = B_3\)</span>. Here, it is
useful for each type of residual to have the same colour scale at both
resolutions.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Residuals of Vegetation model</span></span>
<span><span class="va">Residual_fit1_B3</span> <span class="op">&lt;-</span> <span class="fu">residual_df</span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">fit1</span>, df <span class="op">=</span> <span class="va">As3</span><span class="op">$</span><span class="va">df</span>,</span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">vegetation</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span><span class="op">)</span>, A_sum <span class="op">=</span> <span class="va">As3</span><span class="op">$</span><span class="va">A_sum</span>,</span>
<span>  A_integrate <span class="op">=</span> <span class="va">As3</span><span class="op">$</span><span class="va">A_integrate</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">Residual_fit1_B4</span> <span class="op">&lt;-</span> <span class="fu">residual_df</span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">fit1</span>, df <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">df</span>,</span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">vegetation</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span><span class="op">)</span>, A_sum <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">A_sum</span>,</span>
<span>  A_integrate <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">A_integrate</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Colour scales for each model to cover both resolutions</span></span>
<span><span class="va">fit1_csc</span> <span class="op">&lt;-</span> <span class="fu">set_csc</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">Residual_fit1_B3</span>, <span class="va">Residual_fit1_B4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"RdBu"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Store plots</span></span>
<span><span class="va">plotB3_fit1</span> <span class="op">&lt;-</span> <span class="fu">residual_plot</span><span class="op">(</span><span class="va">B3</span>, <span class="va">Residual_fit1_B3</span>, <span class="va">fit1_csc</span>, <span class="st">"Vegetation Model"</span><span class="op">)</span></span>
<span><span class="va">plotB4_fit1</span> <span class="op">&lt;-</span> <span class="fu">residual_plot</span><span class="op">(</span><span class="va">B4</span>, <span class="va">Residual_fit1_B4</span>, <span class="va">fit1_csc</span>, <span class="st">"Vegetation Model"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># comparing the vegetation model</span></span>
<span><span class="op">(</span><span class="op">(</span><span class="va">plotB3_fit1</span><span class="op">$</span><span class="va">Scaling</span> <span class="op">|</span> <span class="va">plotB3_fit1</span><span class="op">$</span><span class="va">Inverse</span> <span class="op">|</span> <span class="va">plotB3_fit1</span><span class="op">$</span><span class="va">Pearson</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">plotB4_fit1</span><span class="op">$</span><span class="va">Scaling</span> <span class="op">|</span> <span class="va">plotB4_fit1</span><span class="op">$</span><span class="va">Inverse</span> <span class="op">|</span> <span class="va">plotB4_fit1</span><span class="op">$</span><span class="va">Pearson</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Vegetation Model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="comparing-different-types-of-residuals-for-each-model">Comparing different types of residuals for each model<a class="anchor" aria-label="anchor" href="#comparing-different-types-of-residuals-for-each-model"></a>
</h4>
<p>Now, the plots below help to compare the residuals for each model at
two resolutions of <span class="math inline">\(B\)</span> for each type
of residual.</p>
<p><img src="2d_lgcp_residuals_files/figure-html/plot-all-1-1.png" width="864"><img src="2d_lgcp_residuals_files/figure-html/plot-all-1-2.png" width="864"><img src="2d_lgcp_residuals_files/figure-html/plot-all-1-3.png" width="864"><img src="2d_lgcp_residuals_files/figure-html/plot-all-1-4.png" width="864"></p>
<div class="section level5">
<h5 id="discussion">Discussion<a class="anchor" aria-label="anchor" href="#discussion"></a>
</h5>
<p>In this section, we discuss some of the findings from the output in
the code. A relevant point that would be used repeatedly in this
discussion is that since the colour scales for the residuals are chosen
so that negative and positive values are in hues of red and blue
respectively, negative and positive residuals imply an overestimation
and underestimation of gorilla nests by the model respectively. Thus,
red regions in a plot would imply overestimation of gorilla nests by the
model in that region and blue regions in a plot would imply
underestimation of gorilla nests by the model in that region.</p>
<p>A common observation for all models is that the scaling residuals
seem to have the highest range among the residuals since they are direct
interpretations of residuals for all models. Also, the Pearson residuals
seem to take values between the scaling and inverse residuals for both
resolutions of all four models. However, for almost all types of
residuals for each model, the positive and negative residual values are
not very extreme for the <span class="math inline">\(B_3\)</span>
resolution but these corresponding residual values are more extreme at
the <span class="math inline">\(B_4\)</span> resolution for each type of
residual. This could be because of the bias in the ``experimental” mode
of which is explored at other points in this project.</p>
<p>For the vegetation and intercept model, the regions which have
negative and positive residuals remain the same for all residuals at
different levels for each type of residual. Also, it seems that the
north and north-west region of both models are underestimated by the
model while the remaining regions are overestimated by the model at
different levels.</p>
<p>For the elevation model, each type of residual has slight variations
in negative and positive residuals for corresponding regions in a fixed
resolution. This means that different residuals suggest that a
particular polygon in overestimated and underestimated by the model.
However, this happens only at a few points and is not containing
extremes of the residuals in the same regions. The Pearson residuals are
supposedly the most reliable in this case as they are normalised
residuals. All three types of residuals contain larger proportions of
negative residuals which suggest that the model overestimates the
gorilla population the region (at different amounts in different
regions).</p>
</div>
</div>
<div class="section level4">
<h4 id="comparing-different-models-for-each-type-of-residual">Comparing different models for each type of residual<a class="anchor" aria-label="anchor" href="#comparing-different-models-for-each-type-of-residual"></a>
</h4>
<p>Another way to compare residuals, is to consider each type of
residual separately and plot the residuals for all four models at each
resolution. This helps to compare the models for a given type of
residual and choice of <span class="math inline">\(B\)</span>. Here, it
is useful to have the same colour scale for all the 4 models.</p>
<p>The code chunk below demonstrates the code for plotting the “Pearson”
residuals when <span class="math inline">\(B = B_4\)</span>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the residuals for all models at B4</span></span>
<span><span class="va">Residual_fit1_B4</span> <span class="op">&lt;-</span> <span class="fu">residual_df</span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">fit1</span>, df <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">df</span>,</span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">vegetation</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span><span class="op">)</span>, A_sum <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">A_sum</span>,</span>
<span>  A_integrate <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">A_integrate</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">Residual_fit2_B4</span> <span class="op">&lt;-</span> <span class="fu">residual_df</span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">fit2</span>, df <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">df</span>,</span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">elev</span> <span class="op">+</span> <span class="va">mySmooth</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  A_sum <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">A_sum</span>, A_integrate <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">A_integrate</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">Residual_fit3_B4</span> <span class="op">&lt;-</span> <span class="fu">residual_df</span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">fit3</span>, df <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">df</span>,</span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Intercept</span><span class="op">)</span><span class="op">)</span>, A_sum <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">A_sum</span>,</span>
<span>  A_integrate <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">A_integrate</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">Residual_fit4_B4</span> <span class="op">&lt;-</span> <span class="fu">residual_df</span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">fit4</span>, df <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">df</span>,</span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">mySmooth</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span><span class="op">)</span>, A_sum <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">A_sum</span>,</span>
<span>  A_integrate <span class="op">=</span> <span class="va">As4</span><span class="op">$</span><span class="va">A_integrate</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the colour scale</span></span>
<span><span class="va">B4res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">Residual_fit1_B4</span>, <span class="va">Residual_fit2_B4</span>,</span>
<span>  <span class="va">Residual_fit3_B4</span>, <span class="va">Residual_fit4_B4</span></span>
<span><span class="op">)</span></span>
<span><span class="va">B4csc</span> <span class="op">&lt;-</span> <span class="fu">set_csc</span><span class="op">(</span><span class="va">B4res</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"RdBu"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots for residuals of all 4 models with resolution B4</span></span>
<span><span class="va">plotB4_veg</span> <span class="op">&lt;-</span> <span class="fu">residual_plot</span><span class="op">(</span><span class="va">B4</span>, <span class="va">Residual_fit1_B4</span>, <span class="va">B4csc</span>, <span class="st">"Vegetation Model"</span><span class="op">)</span></span>
<span><span class="va">plotB4_elev</span> <span class="op">&lt;-</span> <span class="fu">residual_plot</span><span class="op">(</span><span class="va">B4</span>, <span class="va">Residual_fit2_B4</span>, <span class="va">B4csc</span>, <span class="st">"Elevation Model"</span><span class="op">)</span></span>
<span><span class="va">plotB4_int</span> <span class="op">&lt;-</span> <span class="fu">residual_plot</span><span class="op">(</span><span class="va">B4</span>, <span class="va">Residual_fit3_B4</span>, <span class="va">B4csc</span>, <span class="st">"Intercept Model"</span><span class="op">)</span></span>
<span><span class="va">plotB4_smooth</span> <span class="op">&lt;-</span> <span class="fu">residual_plot</span><span class="op">(</span><span class="va">B4</span>, <span class="va">Residual_fit4_B4</span>, <span class="va">B4csc</span>, <span class="st">"Smooth Model"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Comparing all models for B4 Pearson residuals</span></span>
<span><span class="op">(</span><span class="op">(</span><span class="va">plotB4_veg</span><span class="op">$</span><span class="va">Pearson</span> <span class="op">|</span> <span class="va">plotB4_elev</span><span class="op">$</span><span class="va">Pearson</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">plotB4_int</span><span class="op">$</span><span class="va">Pearson</span> <span class="op">|</span> <span class="va">plotB4_smooth</span><span class="op">$</span><span class="va">Pearson</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span><span class="st">"B4 Pearson Residuals"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p>Now, the plots below help to compare all 4 models at a particular
choice of <span class="math inline">\(B\)</span> and for a chosen
residual type.</p>
<p><img src="2d_lgcp_residuals_files/figure-html/plot-all-2-1.png" width="672"><img src="2d_lgcp_residuals_files/figure-html/plot-all-2-2.png" width="672"><img src="2d_lgcp_residuals_files/figure-html/plot-all-2-3.png" width="672"><img src="2d_lgcp_residuals_files/figure-html/plot-all-2-4.png" width="672"><img src="2d_lgcp_residuals_files/figure-html/plot-all-2-5.png" width="672"><img src="2d_lgcp_residuals_files/figure-html/plot-all-2-6.png" width="672"></p>
<div class="section level5">
<h5 id="discussion-1">Discussion<a class="anchor" aria-label="anchor" href="#discussion-1"></a>
</h5>
<p>Firstly, a common feature in each of the three figures is that the
residual plots for the vegetation and intercept models are relatively
similar and those of the elevation and smooth models are relatively
similar as well for both resolutions for any type of residual. Also, for
a fixed type of residual and a chosen model, the <span class="math inline">\(B_3\)</span> residuals are less extreme compared
to the <span class="math inline">\(B_4\)</span> residuals, plausibly
owing to the bias in the ``experimental” mode in . Another feature in
all three types of residuals is that the elevation and intercept model
have less extreme residual values compared to the vegetation and
intercept models for a given type of residual. This could suggest that
the former two are better models for gorilla nesting in the given
region. The residual values have a wider range when <span class="math inline">\(B=B_4\)</span> than when <span class="math inline">\(B = B_3\)</span>.</p>
<p>For the scaling residuals and the Pearson residuals, the elevation
and smooth models have less extreme values of residuals relative the
vegetation and intercept models. This suggests that the elevation and
smooth models are more suited to estimating the gorilla nesting
locations in <span class="math inline">\(W\)</span>. Also, there is a
significant underestimation in the north-west areas by the vegetation
and intercept models while the same areas are not underestimated by the
other two models. However, as explored in , these residuals are
calculated in the ``experimental” mode of which produces some
overestimates in these two models, so this must be kept in mind while
reaching to conclusions about a suitable model for nesting
locations.</p>
<p>For the inverse residuals, the same observations hold, except the
residuals for the elevation and smooth models have residuals that are
not significantly less extreme relative to the vegetation and intercept
models as seen in the case of the Pearson and scaling residuals for both
resolutions <span class="math inline">\(B_3\)</span> and <span class="math inline">\(B_4\)</span>.</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="code-appendix">Code appendix<a class="anchor" aria-label="anchor" href="#code-appendix"></a>
</h2>
<div class="section level3">
<h3 id="function-definitions">Function definitions<a class="anchor" aria-label="anchor" href="#function-definitions"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Niharika Reddy Peddinenikalva</span></span>
<span><span class="co"># Vacation Scholarship project</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"INLA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://www.inlabru.org" class="external-link">"inlabru"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"RColorBrewer"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-spatial.github.io/lwgeom/" class="external-link">"lwgeom"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://patchwork.data-imaginist.com" class="external-link">"patchwork"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://rspatial.org/" class="external-link">"terra"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com" class="external-link">"data.table"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">#' ----------------------------------</span></span>
<span><span class="co">#' prepare_residual_calculations</span></span>
<span><span class="co">#' ----------------------------------</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Computes the A_sum, A_integrate matrices and the data frame used for</span></span>
<span><span class="co">#' calculating the residuals for the given set of polygons B</span></span>
<span></span>
<span><span class="co">#' Input:</span></span>
<span><span class="co">#' @param samplers A SpatialPolygonDataFrame containing partitions for which</span></span>
<span><span class="co">#' residuals are to be calculated</span></span>
<span><span class="co">#' @param domain A mesh object</span></span>
<span><span class="co">#' @param observations A SpatialPointsDataFrame containing observed data</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Output:</span></span>
<span><span class="co">#' @return A_sum - matrix used to compute the summation term of the residuals</span></span>
<span><span class="co">#' @return A_integrate - matrix used to compute the integral term</span></span>
<span><span class="co">#' @return df - SpatialPointsDataFrame containing all the locations 'u' for</span></span>
<span><span class="co">#' calculating residuals</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">prepare_residual_calculations</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">samplers</span>, <span class="va">domain</span>, <span class="va">observations</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Calculate the integration weights for A_integrate</span></span>
<span>  <span class="va">ips</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_int.html" class="external-link">fm_int</a></span><span class="op">(</span>domain <span class="op">=</span> <span class="va">domain</span>, samplers <span class="op">=</span> <span class="va">samplers</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Set-up the A_integrate matrix</span></span>
<span>  <span class="co"># A_integrate has as many rows as polygons in the samplers,</span></span>
<span>  <span class="co"># as many columns as mesh points</span></span>
<span>  <span class="va">A_integrate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.A.html" class="external-link">inla.spde.make.A</a></span><span class="op">(</span></span>
<span>    mesh <span class="op">=</span> <span class="va">domain</span>, <span class="va">ips</span>, weights <span class="op">=</span> <span class="va">ips</span><span class="op">$</span><span class="va">weight</span>,</span>
<span>    block <span class="op">=</span> <span class="va">ips</span><span class="op">$</span><span class="va">.block</span>, block.rescale <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co"># Set-up the A_sum matrix</span></span>
<span>  <span class="co"># A_sum has as many rows as polygons in the samplers,</span></span>
<span>  <span class="co"># as many columns as observed points</span></span>
<span>  <span class="co"># each row has 1s for the points in the corresponding polygon</span></span>
<span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_within</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">observations</span><span class="op">)</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">samplers</span><span class="op">)</span>, sparse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">A_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html" class="external-link">sparseMatrix</a></span><span class="op">(</span></span>
<span>    i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">idx</span><span class="op">)</span>,</span>
<span>    j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">observations</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">idx</span>, <span class="va">length</span>, <span class="fl">1L</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">idx</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">samplers</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">observations</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co"># Setting up the data frame for calculating residuals</span></span>
<span>  <span class="va">observations</span><span class="op">$</span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/SpatialPoints.html" class="external-link">SpatialPointsDataFrame</a></span><span class="op">(</span></span>
<span>    coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">domain</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">observations</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="va">domain</span><span class="op">$</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>, <span class="va">observations</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>,</span>
<span>    proj4string <span class="op">=</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_CRS_sp.html" class="external-link">fm_CRS</a></span><span class="op">(</span><span class="va">domain</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Return A-sum, A_integrate and the data frame for predicting the residuals</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A_sum <span class="op">=</span> <span class="va">A_sum</span>, A_integrate <span class="op">=</span> <span class="va">A_integrate</span>, df <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">#' ------------</span></span>
<span><span class="co">#' residual_df</span></span>
<span><span class="co">#' ------------</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Computes the three types if residuals and returns a data frame containing</span></span>
<span><span class="co">#' information about all 3 residuals for each partition of 'B'</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Inputs:</span></span>
<span><span class="co">#' @param model fitted model for which residuals need to be calculated</span></span>
<span><span class="co">#' @param df SpatialPointsDataFrame object containing all the locations 'u'</span></span>
<span><span class="co">#' for calculating residuals</span></span>
<span><span class="co">#' @param expr an expression object containing the formula of the model</span></span>
<span><span class="co">#' @param A_sum matrix used to compute the summation term of the residuals</span></span>
<span><span class="co">#' @param A_integrate matrix that computes the integral term of the residuals</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Outputs:</span></span>
<span><span class="co">#' @return Data frame containing residual information for each of the</span></span>
<span><span class="co">#' partitions of the subset 'B'</span></span>
<span><span class="co">#'</span></span>
<span></span>
<span><span class="va">residual_df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">df</span>, <span class="va">expr</span>, <span class="va">A_sum</span>, <span class="va">A_integrate</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Compute residuals</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">model</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">df</span>,</span>
<span>    <span class="op">~</span> <span class="op">{</span></span>
<span>      <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">expr</span><span class="op">)</span></span>
<span>      <span class="va">h1</span> <span class="op">&lt;-</span> <span class="va">lambda</span> <span class="op">*</span> <span class="fl">0</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="va">h2</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">lambda</span></span>
<span>      <span class="va">h3</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        Scaling_Residuals <span class="op">=</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">A_sum</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">h1</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">A_integrate</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">h1</span> <span class="op">*</span> <span class="va">lambda</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="va">obs</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        Inverse_Residuals <span class="op">=</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">A_sum</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">h2</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">A_integrate</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">h2</span> <span class="op">*</span> <span class="va">lambda</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="va">obs</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        Pearson_Residuals <span class="op">=</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">A_sum</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">h3</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">A_integrate</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">h3</span> <span class="op">*</span> <span class="va">lambda</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="va">obs</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    used <span class="op">=</span> <span class="fu"><a href="../reference/bru_used.html">bru_used</a></span><span class="op">(</span><span class="va">expr</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Label the three types of residuals</span></span>
<span>  <span class="va">res</span><span class="op">$</span><span class="va">Scaling_Residuals</span><span class="op">$</span><span class="va">Type</span> <span class="op">&lt;-</span> <span class="st">"Scaling Residuals"</span></span>
<span>  <span class="va">res</span><span class="op">$</span><span class="va">Inverse_Residuals</span><span class="op">$</span><span class="va">Type</span> <span class="op">&lt;-</span> <span class="st">"Inverse Residuals"</span></span>
<span>  <span class="va">res</span><span class="op">$</span><span class="va">Pearson_Residuals</span><span class="op">$</span><span class="va">Type</span> <span class="op">&lt;-</span> <span class="st">"Pearson Residuals"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">#' --------------</span></span>
<span><span class="co">#' set_csc</span></span>
<span><span class="co">#' --------------</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Sets the colour scale for the three types of residuals</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Inputs:</span></span>
<span><span class="co">#' @param residuals frame containing residual information for each of the</span></span>
<span><span class="co">#' partitions of the subset 'B'</span></span>
<span><span class="co">#' @param col_theme vector of themes for each type of residual</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Outputs:</span></span>
<span><span class="co">#' @return a list of 3 colour scales for each type of residual</span></span>
<span><span class="co">#'</span></span>
<span></span>
<span><span class="va">set_csc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">residuals</span>, <span class="va">col_theme</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Store data for the colour scale of the plots for each type of residual</span></span>
<span>  <span class="va">cscrange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">residuals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>maxabs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Set the colour scale for all three types of residuals</span></span>
<span>  <span class="va">scaling_csc</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>      colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="va">col_theme</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Scaling Residual"</span>,</span>
<span>      limits <span class="op">=</span></span>
<span>        <span class="va">cscrange</span><span class="op">[</span><span class="va">cscrange</span><span class="op">$</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Scaling Residuals"</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="va">inverse_csc</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>      colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="va">col_theme</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Inverse Residual"</span>,</span>
<span>      limits <span class="op">=</span></span>
<span>        <span class="va">cscrange</span><span class="op">[</span><span class="va">cscrange</span><span class="op">$</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Inverse Residuals"</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="va">pearson_csc</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>      colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="va">col_theme</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Pearson Residual"</span>,</span>
<span>      limits <span class="op">=</span></span>
<span>        <span class="va">cscrange</span><span class="op">[</span><span class="va">cscrange</span><span class="op">$</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Pearson Residuals"</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Scaling"</span> <span class="op">=</span> <span class="va">scaling_csc</span>, <span class="st">"Inverse"</span> <span class="op">=</span> <span class="va">inverse_csc</span>, <span class="st">"Pearson"</span> <span class="op">=</span> <span class="va">pearson_csc</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">#' ---------------</span></span>
<span><span class="co">#' residual_plot</span></span>
<span><span class="co">#' ---------------</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' plots the three types of residuals for each polygon</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Input:</span></span>
<span><span class="co">#' @param samplers A SpatialPolygonsDataFrame containing partitions for which</span></span>
<span><span class="co">#' residuals are to be calculated</span></span>
<span><span class="co">#' @param residuals frame containing residual information for each of the</span></span>
<span><span class="co">#' partitions of the subset 'B'</span></span>
<span><span class="co">#' @param csc list of three colour scales for the three types of residuals</span></span>
<span><span class="co">#' @param model_name string containing the name of the model being assessed</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Output:</span></span>
<span><span class="co">#' @return a list of three subplots scaling, inverse and Pearson residuals</span></span>
<span><span class="co">#' for the different partitions of samplers</span></span>
<span></span>
<span></span>
<span><span class="va">residual_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">samplers</span>, <span class="va">residuals</span>, <span class="va">csc</span>, <span class="va">model_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Initialise the scaling residuals plot</span></span>
<span>  <span class="va">samplers</span><span class="op">$</span><span class="va">Residual</span> <span class="op">&lt;-</span> <span class="va">residuals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Scaling Residuals"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span>
<span>  <span class="va">scaling</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">samplers</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Residual</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">csc</span><span class="op">[</span><span class="st">"Scaling"</span><span class="op">]</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">model_name</span>, <span class="st">"Scaling"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Initialise the inverse residuals plot</span></span>
<span>  <span class="va">samplers</span><span class="op">$</span><span class="va">Residual</span> <span class="op">&lt;-</span> <span class="va">residuals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Inverse Residuals"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span>
<span>  <span class="va">inverse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">samplers</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Residual</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">csc</span><span class="op">[</span><span class="st">"Inverse"</span><span class="op">]</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">model_name</span>, <span class="st">"Inverse"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Initialise the Pearson residuals plot</span></span>
<span>  <span class="va">samplers</span><span class="op">$</span><span class="va">Residual</span> <span class="op">&lt;-</span> <span class="va">residuals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Pearson Residuals"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span>
<span>  <span class="va">pearson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">samplers</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Residual</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">csc</span><span class="op">[</span><span class="st">"Pearson"</span><span class="op">]</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">model_name</span>, <span class="st">"Pearson"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Return the three plots in a list</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    Scaling <span class="op">=</span> <span class="va">scaling</span>, Inverse <span class="op">=</span> <span class="va">inverse</span>,</span>
<span>    Pearson <span class="op">=</span> <span class="va">pearson</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">#' ------------------</span></span>
<span><span class="co">#' partition</span></span>
<span><span class="co">#' ------------------</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Partitions the region based on the given criteria for calculating residuals</span></span>
<span><span class="co">#' in each partition. Parts of this function are taken from concepts in</span></span>
<span><span class="co">#' https://rpubs.com/huanfaChen/grid_from_polygon</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Input:</span></span>
<span><span class="co">#' @param samplers A SpatialPolygonsDataFrame containing region for which</span></span>
<span><span class="co">#' partitions need to be created</span></span>
<span><span class="co">#' @param resolution resolution of the grids that are required</span></span>
<span><span class="co">#' @param nrows number of rows of grids that are required</span></span>
<span><span class="co">#' @param ncols number of columns of grids that are required</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Output:</span></span>
<span><span class="co">#' @return a partitioned SpatialPolygonsDataFrame as required</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">partition</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">samplers</span>, <span class="va">resolution</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">nrows</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">ncols</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Create a grid for the given boundary</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">resolution</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">samplers</span><span class="op">)</span>,</span>
<span>      crs <span class="op">=</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/is.projected.html" class="external-link">proj4string</a></span><span class="op">(</span><span class="va">samplers</span><span class="op">)</span>,</span>
<span>      nrows <span class="op">=</span> <span class="va">nrows</span>, ncols <span class="op">=</span> <span class="va">ncols</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nrows</span>, <span class="va">ncols</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">samplers</span><span class="op">)</span>,</span>
<span>      crs <span class="op">=</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/is.projected.html" class="external-link">proj4string</a></span><span class="op">(</span><span class="va">samplers</span><span class="op">)</span>,</span>
<span>      resolution <span class="op">=</span> <span class="va">resolution</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">gridPolygon</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.polygons.html" class="external-link">as.polygons</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Extract the boundary with subpolygons only</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html" class="external-link">as_Spatial</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/intersect.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">gridPolygon</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">samplers</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">#' ------------------</span></span>
<span><span class="co">#' edit_df</span></span>
<span><span class="co">#' ------------------</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Edits the residual data frames to remove columns that need not be displayed</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Input:</span></span>
<span><span class="co">#' @param df the data frame which needs to be edited</span></span>
<span><span class="co">#' @param columns a vector of columns that need to be deleted from df</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Output:</span></span>
<span><span class="co">#' @return the edited data frame with only the desired columns</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">edit_df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">columns</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Remove the columns that are not required</span></span>
<span>  <span class="va">df</span><span class="op">[</span>, <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="va">columns</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Finn Lindgren, Fabian E. Bachl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
