<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Obtain component inputs"><title>Obtain component inputs — input_eval • inlabru</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Obtain component inputs — input_eval"><meta property="og:description" content="Obtain component inputs"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">inlabru</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.10.1.9007</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-general-examples">General examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-general-examples">
    <h6 class="dropdown-header" data-toc-skip>Basic examples</h6>
    <a class="dropdown-item" href="../articles/random_fields.html">Random field models in 1D</a>
    <a class="dropdown-item" href="../articles/random_fields_2d.html">Spatial random field models in 2D</a>
    <a class="dropdown-item" href="../articles/publications.html">Publications</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Concepts</h6>
    <a class="dropdown-item" href="../articles/component.html">Defining a model component</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Special models and techniques</h6>
    <a class="dropdown-item" href="../articles/svc.html">Spatially varying coefficient models</a>
    <a class="dropdown-item" href="../articles/zip_zap_models.html">ZIP and ZAP count models (zero-inflation)</a>
    <a class="dropdown-item" href="../articles/prediction_scores.html">Computing posterior prediction scores</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/articles.html">Full articles list</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-point-processes">Point processes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-point-processes">
    <h6 class="dropdown-header" data-toc-skip>Point process examples</h6>
    <a class="dropdown-item" href="../articles/1d_lgcp.html">LGCPs - An example in one dimension</a>
    <a class="dropdown-item" href="../articles/2d_lgcp.html">LGCPs - An example in two dimensions (sp version)</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_sf.html">LGCPs - An example in two dimensions (sf version)</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_covars.html">LGCPs - Spatial covariates</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_distancesampling.html">LGCPs - Distance sampling</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_plotsampling.html">LGCPs - Plot sampling</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_multilikelihood.html">LGCPs - Multiple likelihoods</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_spatiotemporal.html">LGCPs - An example in space and time</a>
    <a class="dropdown-item" href="../articles/2d_lgcp_residuals.html">LGCPs - Residuals</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-technical-articles">Technical articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-technical-articles">
    <h6 class="dropdown-header" data-toc-skip>Mapper techniques</h6>
    <a class="dropdown-item" href="../articles/bru_mapper.html">Customised model component with the bru_mapper system</a>
    <a class="dropdown-item" href="../articles/mesh_mapping.html">Converting inla.spde.make.A calls to the bru_mapper system</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Theory and technical documentation</h6>
    <a class="dropdown-item" href="../articles/Apptainer.html">Installation of INLA and inlabru with Apptainer on HPC</a>
    <a class="dropdown-item" href="../articles/method.html">The iterative linearised inlabru method</a>
    <a class="dropdown-item" href="../articles/linearapprox.html">A nonlinear model approximation example</a>
    <a class="dropdown-item" href="../articles/devel_flow.html">Code internal flow diagrams for model evaluation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/inlabru-org/inlabru/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Obtain component inputs</h1>
      <small class="dont-index">Source: <a href="https://github.com/inlabru-org/inlabru/blob/HEAD/R/effect.R" class="external-link"><code>R/effect.R</code></a></small>
      <div class="d-none name"><code>input_eval.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Obtain component inputs</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">input_eval</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for component</span></span>
<span><span class="fu">input_eval</span><span class="op">(</span><span class="va">component</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for component_list</span></span>
<span><span class="fu">input_eval</span><span class="op">(</span><span class="va">components</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for bru_input</span></span>
<span><span class="fu">input_eval</span><span class="op">(</span><span class="va">input</span>, <span class="va">data</span>, env <span class="op">=</span> <span class="cn">NULL</span>, null.on.fail <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>...</dt>
<dd><p>Unused.</p></dd>


<dt>component</dt>
<dd><p>A component.</p></dd>


<dt>data</dt>
<dd><p>A <code>data.frame</code>, <code>tibble</code>, <code>sf</code>, <code>list</code>, or <code>Spatial*</code> object of
covariates and/or point locations.
If <code>NULL</code>, return the component's map.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An list of mapper input values, formatted for the full component mapper
(of type <code>bru_mapper_pipe</code>)</p>
    </div>
    <div class="section level2">
    <h2 id="methods-by-class-">Methods (by class)<a class="anchor" aria-label="anchor" href="#methods-by-class-"></a></h2>
    
<ul><li><p><code>input_eval(bru_input)</code>: Attempts to evaluate a component input (e.g. <code>main</code>,
<code>group</code>, <code>replicate</code>, or <code>weight</code>), and process the results:</p><ol><li><p>If <code><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval()</a></code> failed, return NULL or map everything to 1
(see the <code>null.on.fail</code> argument). This should normally not
happen, unless the component use logic is incorrect,
(e.g. via <code>include</code>/<code>exclude</code>)
leading to missing columns for a certain likelihood in a
multi-<code><a href="like.html">like()</a></code> model.</p></li>
<li><p>If we obtain a function, apply the function to the data object</p></li>
<li><p>If we obtain an object supported by <code><a href="eval_spatial.html">eval_spatial()</a></code>, extract the values
of that data frame at the point locations</p></li>
<li><p>Else we obtain a vector and return as-is. This happens when input
references a column of the data points, or some other complete expression</p></li>
</ol></li>
</ul></div>
    <div class="section level2">
    <h2 id="simple-covariates-and-the-map-parameter">Simple covariates and the map parameter<a class="anchor" aria-label="anchor" href="#simple-covariates-and-the-map-parameter"></a></h2>
    


<p>It is not unusual for a random effect act on a transformation of a covariate. In other frameworks this
would mean that the transformed covariate would have to be calculated in advance and added to the
data frame that is usually provided via the <code>data</code> parameter. inlabru provides the option to do
this transformation automatically. For instance, one might be interested in the effect of a covariate
\(x^2\). In inla and other frameworks this would require to add a column <code>xsquared</code> to the
input data frame and use the formula</p>
<ul><li><p><code>formula = y ~ f(xsquared, model = "linear")</code>,</p></li>
</ul><p>In inlabru this can be achieved in several ways of using the <code>main</code> parameter
(<code>map</code> in version 2.1.13 and earlier), which does not need to be named.</p>
<ul><li><p><code>components = y ~ psi(main = x^2, model = "linear")</code></p></li>
<li><p><code>components = y ~ psi(x^2, model = "linear")</code></p></li>
<li><p><code>components = y ~ psi(mySquareFun(x), model = "linear")</code>,</p></li>
<li><p><code>components = y ~ psi(myOtherSquareFun, model = "linear")</code>,</p></li>
</ul><p>In the first example inlabru will interpret the map parameter as an expression to be evaluated within
the data provided. Since \(x\) is a known covariate it will know how to calculate it. The second
example is an expression as well but it uses a function called <code>mySquareFun</code>. This function is
defined by user but has to be accessible within the work space when setting up the components.
The third example provides the function <code>myOtherSquareFun</code>. In this case,
inlabru will call the function as <code>myOtherSquareFun(.data.)</code>, where <code>.data.</code>
is the data provided via the <code><a href="like.html">like()</a></code> <code>data</code> parameter.
The function needs to know what parts of the data to use to construct the
needed output. For example,</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>myOtherSquareFun <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  data[ ,<span class="st">"x"</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>}</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="spatial-covariates">Spatial Covariates<a class="anchor" aria-label="anchor" href="#spatial-covariates"></a></h2>
    


<p>When fitting spatial models it is common to work with covariates that depend on space, e.g. sea
surface temperature or elevation. Although it is straightforward to add this data to the input
data frame or write a covariate function like in the previous section there is an even more
convenient way in inlabru. Spatial covariates are often stored as <code>SpatialPixelsDataFrame</code>,
<code>SpatialPixelsDataFrame</code> or <code>RasterLayer</code> objects. These can be provided directly via
the input expressions if they are supported by <code><a href="eval_spatial.html">eval_spatial()</a></code>, and
the <code><a href="like.html">like()</a></code> data is an <code>sf</code> or <code>SpatialPointsDataFrame</code> object.
<code>inlabru</code> will then automatically
evaluate and/or interpolate the covariate at your data locations when using code like</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>components <span class="ot">=</span> y <span class="sc">~</span> <span class="fu">psi</span>(mySpatialPixels, <span class="at">model =</span> <span class="st">"linear"</span>)</span></code></pre><p></p></div>
<p>For more precise control, use the the <code>layer</code> and <code>selector</code> arguments (see <code><a href="component.html">component()</a></code>),
or call <code><a href="eval_spatial.html">eval_spatial()</a></code> directly, e.g.:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>components <span class="ot">=</span> y <span class="sc">~</span> <span class="fu">psi</span>(<span class="fu">eval_spatial</span>(mySpatialPixels, <span class="at">where =</span> .data.), <span class="at">model =</span> <span class="st">"linear"</span>)</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="coordinates">Coordinates<a class="anchor" aria-label="anchor" href="#coordinates"></a></h2>
    


<p>A common spatial modelling component when using inla are SPDE models. An important feature of
inlabru is that it will automatically calculate the so called A-matrix (a component model matrix)
which maps SPDE
values at the mesh vertices to values at the data locations. For this purpose, the input
can be set to <code>coordinates</code>, which is the <code>sp</code> package function that extracts point
coordinates from the <code>SpatialPointsDataFrame</code> that was provided as input to <code><a href="like.html">like()</a></code>. The code for
this would look as follows:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>components <span class="ot">=</span> y <span class="sc">~</span> <span class="fu">field</span>(coordinates, <span class="at">model =</span> <span class="fu">inla.spde2.matern</span>(...))</span></code></pre><p></p></div>
<p>Since <code>coordinates</code> is a function from the <code>sp</code> package, this results in
evaluation of <code>sp::coordinates(.data.)</code>, which loses any CRS information
from the data object.</p>
<p>For <code>sf</code> data with a geometry column (by default named <code>geometry</code>), use</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>components <span class="ot">=</span> y <span class="sc">~</span> <span class="fu">field</span>(geometry, <span class="at">model =</span> <span class="fu">inla.spde2.matern</span>(...))</span></code></pre><p></p></div>
<p>Since the CRS information is part of the geometry column of the <code>sf</code> object,
this retains CRS information, so this is more robust, and allows the model
to be built on a different CRS than the observation data.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="component.html">component()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Fabian E. Bachl <a href="mailto:bachlfab@gmail.com">bachlfab@gmail.com</a>, Finn Lindgren <a href="mailto:finn.lindgren@gmail.com">finn.lindgren@gmail.com</a></p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Finn Lindgren, Fabian E. Bachl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

