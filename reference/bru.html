<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Convenient model fitting using (iterated) INLA — bru • inlabru</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Convenient model fitting using (iterated) INLA — bru"><meta property="og:description" content="This method is a wrapper for INLA::inla and provides
multiple enhancements.

Easy usage of spatial covariates and automatic construction
of inla projection matrices for (spatial) SPDE models. This feature is
accessible via the components parameter. Practical examples on how
to use spatial data by means of the components parameter can also be found
by looking at the lgcp function's documentation.
Constructing multiple likelihoods is straight forward. See like for more
information on how to provide additional likelihoods to bru using
the ... parameter list.
Support for non-linear predictors. See example below.
Log Gaussian Cox process (LGCP) inference is
available by using the cp family or (even easier) by using the
lgcp function.

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">inlabru</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.5.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/linearapprox.html">Nonlinear model approximation</a>
    </li>
    <li>
      <a href="../articles/method.html">Iterative INLA method</a>
    </li>
    <li>
      <a href="../articles/web/1d_lgcp.html">LGCPs - An example in one dimension</a>
    </li>
    <li>
      <a href="../articles/web/2d_lgcp.html">LGCPs - An example in two dimensions</a>
    </li>
    <li>
      <a href="../articles/web/2d_lgcp_covars.html">LGCPs - Spatial covariates</a>
    </li>
    <li>
      <a href="../articles/web/2d_lgcp_distancesampling.html">LGCPs - Distance sampling</a>
    </li>
    <li>
      <a href="../articles/web/2d_lgcp_multilikelihood.html">LGCPs - Multiple Likelihoods</a>
    </li>
    <li>
      <a href="../articles/web/2d_lgcp_plotsampling.html">LGCPs - Plot sampling</a>
    </li>
    <li>
      <a href="../articles/web/2d_lgcp_spatiotemporal.html">LGCPs - An example in space and time</a>
    </li>
    <li>
      <a href="../articles/web/publications.html">Publications</a>
    </li>
    <li>
      <a href="../articles/web/random_fields.html">Random Fields in One Dimension</a>
    </li>
    <li>
      <a href="../articles/web/random_fields_2d.html">Random Fields in 2D</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/inlabru-org/inlabru/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convenient model fitting using (iterated) INLA</h1>
    <small class="dont-index">Source: <a href="https://github.com/inlabru-org/inlabru/blob/HEAD/R/bru.inference.R" class="external-link"><code>R/bru.inference.R</code></a></small>
    <div class="hidden name"><code>bru.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This method is a wrapper for <code><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">INLA::inla</a></code> and provides
multiple enhancements.</p>
<ul><li><p>Easy usage of spatial covariates and automatic construction
of inla projection matrices for (spatial) SPDE models. This feature is
accessible via the <code>components</code> parameter. Practical examples on how
to use spatial data by means of the components parameter can also be found
by looking at the <a href="lgcp.html">lgcp</a> function's documentation.</p></li>
<li><p>Constructing multiple likelihoods is straight forward. See <a href="like.html">like</a> for more
information on how to provide additional likelihoods to <code>bru</code> using
the <code>...</code> parameter list.</p></li>
<li><p>Support for non-linear predictors. See example below.</p></li>
<li><p>Log Gaussian Cox process (LGCP) inference is
available by using the <code>cp</code> family or (even easier) by using the
<a href="lgcp.html">lgcp</a> function.</p></li>
</ul></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">bru</span><span class="op">(</span>components <span class="op">=</span> <span class="op">~</span><span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="va">...</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, .envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu">bru_rerun</span><span class="op">(</span><span class="va">result</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>components</dt>
<dd><p>A <code>formula</code>-like specification of latent components.
Also used to define a default linear additive predictor.  See
<code><a href="component.html">component()</a></code> for details.</p></dd>
<dt>...</dt>
<dd><p>Likelihoods, each constructed by a calling <code><a href="like.html">like()</a></code>, or named
parameters that can be passed to a single <code><a href="like.html">like()</a></code> call. Note that
all the arguments will be evaluated before calling <code><a href="like.html">like()</a></code> in order
to detect if they are <code>like</code> objects. This means that
special arguments that need to be evaluated in the context of
<code>response_data</code> or <code>data</code> (such as Ntrials) may will only work that
way in direct calls to <code><a href="like.html">like()</a></code>.</p></dd>
<dt>options</dt>
<dd><p>A <a href="bru_options.html">bru_options</a> options object or a list of options passed
on to <code><a href="bru_options.html">bru_options()</a></code></p></dd>
<dt>.envir</dt>
<dd><p>Environment for component evaluation (for when a non-formula
specification is used)</p></dd>
<dt>result</dt>
<dd><p>A previous estimation object of class <code>bru</code></p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>bru returns an object of class "bru". A <code>bru</code> object inherits
from <code><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">INLA::inla</a></code> (see the inla documentation for its properties) and
adds additional information stored in the <code>bru_info</code> field.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    
<ul><li><p><code>bru_rerun</code> Continue the optimisation from a previously computed estimate.</p></li>
</ul></div>
    <div id="author">
    <h2>Author</h2>
    <p>Fabian E. Bachl <a href="mailto:bachlfab@gmail.com">bachlfab@gmail.com</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="bru_safe_inla.html">bru_safe_inla</a></span><span class="op">(</span>multicore <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># Simulate some covariates x and observations y</span></span>
<span class="r-in">  <span class="va">input.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">input.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">input.df</span>, <span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># Fit a Gaussian likelihood model</span></span>
<span class="r-in">  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">bru</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">Intercept</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, data <span class="op">=</span> <span class="va">input.df</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># Obtain summary</span></span>
<span class="r-in">  <span class="va">fit</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Current num.threads is '2:1'.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting INLA option num.threads to '1:1'. Previous value '2:1'.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>All covariate evaluations for 'Intercept' are NULL; an intercept component was likely intended.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>   Implicit latent intercept component specification is deprecated since version 2.1.14.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>   Use explicit notation '+ Intercept(1)' instead (or '+1' for '+ Intercept(1)').</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               mean         sd 0.025quant 0.5quant 0.975quant mode          kld</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x         2.030629 0.03647021   1.957793 2.030630   2.103464   NA 9.187950e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept 4.932263 0.02579438   4.880749 4.932263   4.983775   NA 9.103436e-08</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="bru_safe_inla.html">bru_safe_inla</a></span><span class="op">(</span>multicore <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># Alternatively, we can use the like() function to construct the likelihood:</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="va">lik</span> <span class="op">&lt;-</span> <span class="fu"><a href="like.html">like</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"gaussian"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">Intercept</span>, data <span class="op">=</span> <span class="va">input.df</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">bru</span><span class="op">(</span><span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="va">lik</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">fit</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Current num.threads is '1:1'.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No num.threads change needed.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               mean         sd 0.025quant 0.5quant 0.975quant mode          kld</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x         2.030629 0.03647806   1.957777 2.030630   2.103480   NA 9.522303e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept 4.932263 0.02579993   4.880738 4.932263   4.983786   NA 9.435353e-08</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># An important addition to the INLA methodology is bru's ability to use</span></span>
<span class="r-in"><span class="co"># non-linear predictors. Such a predictor can be formulated via like()'s</span></span>
<span class="r-in"><span class="co"># \code{formula} parameter. The z(1) notation is needed to ensure that</span></span>
<span class="r-in"><span class="co"># the z component should be interpreted as single latent variable and not</span></span>
<span class="r-in"><span class="co"># a covariate:</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="bru_safe_inla.html">bru_safe_inla</a></span><span class="op">(</span>multicore <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span class="r-in">  <span class="va">input.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">input.df</span>, <span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">lik</span> <span class="op">&lt;-</span> <span class="fu"><a href="like.html">like</a></span><span class="op">(</span></span>
<span class="r-in">    family <span class="op">=</span> <span class="st">"gaussian"</span>, data <span class="op">=</span> <span class="va">input.df</span>,</span>
<span class="r-in">    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">Intercept</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in">  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">bru</span><span class="op">(</span><span class="op">~</span> <span class="fu">z</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="va">lik</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># Check the result (z posterior should be around 2)</span></span>
<span class="r-in">  <span class="va">fit</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Current num.threads is '1:1'.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No num.threads change needed.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               mean          sd 0.025quant 0.5quant 0.975quant mode          kld</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z         2.008486 0.006931577   1.994655 2.008486   2.022318   NA 6.886430e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept 5.008866 0.036150735   4.936668 5.008867   5.081062   NA 8.894928e-08</span>
<span class="r-in"><span class="co"># }</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Finn Lindgren, Fabian E. Bachl.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

